Modula2DataBase                                                 Simple print support.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ #1 Cursor control, quasy-ArrP                      07/22/90 ) VARIABLE Q-ArrP                                                 VARIABLE TQV                                                    : KEtRA NOOP ;                                                  : d-indx ( --- )                                                nOOL- PiX @ DUP 11 = IF DROP 7 ELSE 1+ THEN PiX ! nOOL+ ;       : u-indx ( --- )                                                nOOL- PiX @ DUP 7 = IF DROP 11 ELSE 1 - THEN PiX ! nOOL+ ;      : P-ArrP ( --- )                                                JUURIK @ AIT !                                                  ( 212 DECL DUP ArrP ! Q-ArrP ! )                                ( MASTER_RECORD 54 + C@ MASTER-R @ 16 + ! )                     80 DECL EXPUHVER !  80 DECL KRPUHVER ! 80 DECL MARKBUFFER !     EXPUHVER @ @TL BL FILL      KRPUHVER @ @TL 196 FILL             TRADE_MARK FILL-EXP                                             ( 0 ArrP ! ) ;                  -->                             \ #2 Cursor control, quasy-ArrP                      07/22/90 ) : shOW_OPTIONS ( --- )                                          5 9 PR-P ! 1 10 PR-P !                                          12 7 DO I DUP 1 - PR-P @ PPT_TAB @ EXECUTE LOOP ;               : LiigU ( key --- )                                             CASE DOWNARROW  OF d-indx                   ENDOF                    UPARROW    OF u-indx                   ENDOF                    RIGHTARROW OF n-INDX ENDOF LEFTARROW  OF p-INDX ENDOF           F1         OF  MDB-HELP CURSOR-OFF     ENDOF                    F3         OF SWITCH-P/D               ENDOF                    F4         OF RIPP-FTX                 ENDOF                    F5         OF RIPP-FA                  ENDOF                    F7         OF SWITCH-PTY ENDOF F8  OF SWITCH-A/C ENDOF          F10        OF SWITCH-F/F ENDOF ALT-P OF WriteScr ENDOF          ( else )    7 EMIT                                         ENDCASE sHOW_OPTION ;      -->                                  \ #3 Option table                                    07/22/90 ) -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ #4 Set options                                     07/22/90 ) : seT_OPTIONS ( --- f )                                         CURSOR-OFF                                                      shOW_OPTIONS nOOL+                                              BEGIN KELL PCKEY CASE EXITFLAG OF        0  EXIT  ENDOF                               NEWLINE  OF ?Ok                                                             IF -1 EXIT THEN ENDOF                               0        OF LiigU           ENDOF                               ( else )  7 EMIT                                           ENDCASE                                        AGAIN                                                           CURSOR-ON ;                                                     : SEADE<> ( --- )                                               P/D @ 2 <> IF CONSOLE THEN KEtRA DROP                           P/D @ 2 <> IF >TRYKK THEN ;                                     -->                                                             \ #5 Set print                                       07/22/90 ) : Set_print ( --- f )                                           >vPUHVER CURSOR-OFF                                             p-WINDOW W-BORDER p-WINDOW W-CLEAR                              27 3 pWG ." KIRJE  TR" "Y ." KK" sEXPR 7 PiX ! SET_P-O          seT_OPTIONS PAGE" ?PILU ;                                                                                                       : SIMPLE_PRINT ( --- )                                          DP @ MEMM$ ! ( P-ArrP Q-ArrP @ ArrP ! ) Set_print               IF P/D @ 2 = IF CLEARSCREEN THEN                                   PILU@ PILU ! FP-SUPPORT >TRYKK ?#PAAN 0                           DO 1 LK-NR ! 1 RIDANR ! I JOTT ! I PILU! PRINT_EXP                 BEFORE_FREE AFTER_FREE END-OF-CHART                          LOOP TOLL->                                                THEN CONSOLE 0 ArrP ! MEMM$ @ DP ! <vPUHVER CURSOR-ON ;         -->                                                             \ #6 Print  record                                   05/12/90 ) : TRYKI!KIRJE ( --- )                                              ArrP @ 196 + @ EXPUHVER ! ArrP @ 200 + @ KRPUHVER ! FILL-EXP    ArrP @ 204 + @ MARKBUFFER ! SET_PRINT                             IF PILU@ PILU ! DP @ MEMM$ ! FP-SUPPORT >TRYKK                     POP-ON ?#PAAN 0                                                 DO 1 LK-NR ! 1 RIDANR ! I JOTT ! I PILU! PRINT_EXP                 BEFORE_FREE GET-REVA ReVa ! @0 @156 0                          DO DUP J PILU@ * + PRINT_LINE @76 + LOOP                         AFTER_FREE END-OF-CHART                                      LOOP TOLL-> MEMM$ @ DP ! P/D @ 2 = IF KEY DROP THEN          THEN                                                          <vPUHVER CURSOR-ON ;                                         -->                                                                                                                                                                                             \ #7 Print file                                      12/03/90 ) : TRYKIPEA  ( --- )                                             @0 @116 0 DO DUP JOTT @ PILU@ * + PRINT_LINE @76 + LOOP ;       : TRYKISABA  ( --- )                                            @0 @156 1 - @76 * + JOTT @ PILU@ * + PRINT_LINE ;               : PORTS ( --- )                                                 TRYKIPEA                                                        BEGIN @0 @116 @76 * + I-KIRJE @ 1+ 0                             DO DUP JOTT @ PILU@ * + PRINT_LINE @76 + Escape?                   IF -1 FAILIOTS ! 1 KATK ! LEAVE THEN LOOP                    FAILIOTS @ 0 < IF 0 FAILIOTS ! -1                                              ELSE SCROLL-LK-DOWN                                              IF I-KIRJE @ tNIFF I-KIRJE ! 0 ELSE -1 THEN                    THEN                                            UNTIL TRYKISABA ;                                               -->                                                             \ #8 Print  file                                     05/12/90 ) : TRYKI!FILE  ( --- )                                              ArrP @ 196 + @ EXPUHVER ! ArrP @ 200 + @ KRPUHVER ! FILL-EXP    ArrP @ 204 + @ MARKBUFFER !   SET_PRINT                           IF PILU@ PILU ! DP @ MEMM$ ! FP-SUPPORT >TRYKK                     POP-ON ?#PAAN 0                                                 DO 1 LK-NR ! 1 RIDANR ! I JOTT ! I PILU! PRINT_EXP                 BEFORE_FREE GET-REVA ReVa ! 0 FAILIOTS !                        TQV @ 4 LAbS ! SEADE<> PORTS                                    AFTER_FREE END-OF-CHART KATK @ 1 = IF LEAVE THEN             LOOP TOLL-> MEMM$ @ DP ! P/D @ 2 = IF KEY DROP THEN          THEN                                                          <vPUHVER CURSOR-ON ;                                         -->                                                                                                                                                                                             \ #9 Print  file                                     05/12/90 ) : TRYKI_PRN ( --- )                                             0 KATK ! HF-PWINDOW                                             ?PRN IF PRINTER ?PLOKK                                               IF  @TT 1 = IF TRYKI!KIRJE ELSE  SIMPLE_PRINT THEN                ELSE TRYKI!FILE                                                 THEN RESET_PRN/OPT CONSOLE                                    ELSE Iy TEADE ." Printer pole valmis. Kordan? " Iyo ?YES         IF  LUUD Iy TEADE  ." Kas printer on laetav? " Iyo ?YES           IF LAADI-TRYKK THEN MYSELF                                    ELSE 1 3 LAbS !                                                 THEN LUUD                                                      THEN                                                       HF-HWINDOW ;                                                    -->                                                                                                                             \ #10 Print record                                   12/03/90 ) : TRYKI_DSK ( --- )                                             0 KATK ! INIT-P>D PRT>DSK                                       ?PLOKK                                                           IF   @TT 1 = IF TRYKI!KIRJE ELSE  SIMPLE_PRINT  THEN            ELSE TRYKI!FILE                                                 THEN CLOSE-P>D                                                 CONSOLE ;                                                       : TRYKI_CON ( --- )                                             0 KATK !                                                        ?PLOKK                                                           IF   @TT 1 = IF TRYKI!KIRJE ELSE  SIMPLE_PRINT  THEN            ELSE TRYKI!FILE                                                 THEN ;                                                         -->                                                                                                                             \ #11 Print record                                   12/03/90 ) : TRYKI_KIRJE ( --- )                                           P/D @ CASE 0 OF TRYKI_PRN ENDOF                                            1 OF TRYKI_DSK ENDOF                                            2 OF TRYKI_CON ENDOF                                       ENDCASE ;                                                 ;S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              