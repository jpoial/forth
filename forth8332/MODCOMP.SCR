( Modula-2 make file creation                        10/15/89 ) (                                                                       This file contains source to maintain imports              to Modula-2 first-level modules. MAKEFILE will be               created/updated.                                                                                                                     Copyright (c), 1989, Viljo Soo, Jaanus Po"ial.                          Tartu University, Estonia                                                                                       )                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( Regimes                                            07/27/90 ) : MCODEREG ( --- ; regime for forth code )                          CH&SYS LIT" MCODE" COUNT 0UTP TEX&SYS 0UTP GENTEXT              CUT$ POST$ OR SEM&SYS SLINK ! UUSTIPP ;                     : SYSPOST ( --- ; regime, generates SYSNAME to the end of                         subtree, leaves SEM=SYSNAME )                     GENTEXT CH&SYS TEX&SYS 0UTP CUT$ POST$ OR SEM&SYS SLINK !       UUSTIPP ;                                                            -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( Regimes                                            07/27/90 ) : COLON ( --- ; REGIME )                                        CH&SYS KOOLON 0UTP TEX&SYS 0UTP GENTEXT                         CUT$ POST$ OR SEM&SYS SLINK ! UUSTIPP ;                         : TRANS ( --- ; REGIME )                                        GENTEXT CUT$ SEM0 SLINK ! UUSTIPP ;                             : TRNAME ( --- ; REGIME )                                       GENTEXT NTRANS @ SEM$ + DUP C@ CUT$ OR OVER C! SLINK !          UUSTIPP ;                                                       : COLON0 FLOW @ 0 FLOW ! COLON FLOW ! ;                         : COLON1 FLOW @ 1 FLOW ! COLON FLOW ! ;                         : TRANS0 FLOW @ 0 FLOW ! TRANS FLOW ! ;                         : TRANS1 FLOW @ 1 FLOW ! TRANS FLOW ! ;                         : TRNAME0 FLOW @ 0 FLOW ! TRNAME FLOW ! ;                       : TRNAME1 FLOW @ 1 FLOW ! TRNAME FLOW ! ;                            -->                                                        (                                                    09/13/90 ) -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (                                                    10/15/89 ) : CAP ( chr1 --- chr2 )                                                 DUP ASCII a < OVER ASCII z > OR 0=                              IF 20 - THEN ;                                          : CAPITALIZE ( addr --- )                                               COUNT 0                                                         ?DO DUP I + DUP C@ CAP SWAP C!                                  LOOP DROP ;                                             : COUNTZ ( addr --- addr l )                                            DUP 0 SCAN DROP OVER - ;                                -->                                                                                                                                                                                                                                                                                                                                                                                             (                                                    10/23/89 ) HEX                                                             : HEREPARA HERE 0F + 0FFFF0 AND DUP DP ! ;                      VARIABLE ENV_ADDR                                               : COPY_ENV 2C H@ 0 HEREPARA DUP ENV_ADDR ! ADDR>S&O                     DUP 10 ->L SWAP 0FFFF AND                                       COUNT_ENV DUP ALLOT CMOVEL ;                            : GET_ENV ( addr1 --- addr2 )                                           ENV_ADDR @                                                      BEGIN 2DUP SWAP COUNT S= OVER C@ 0= OR 0=                       WHILE 0 SCAN DROP 1+                                            REPEAT DUP C@ IF SWAP C@ +                                                    ELSE SWAP DROP THEN ;                     -->                                                                                                                                                                                             (                                                    10/15/89 )                                                                 : INIT_OBJ COPY_ENV LIT" OBJECT=" GET_ENV                               COUNTZ DUP OBJECTPATH C!                                        OBJECTPATH 1+ SWAP CMOVE ;                                                                 -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (                                                    10/15/89 ) : INIT_TARGET ( addr --- )                                              0 LOADNAME ! RESULTFILE DROP 40 ERASE                           BL WORD DUP C@ 8 MIN OVER C!                                    DUP CAPITALIZE                                                  LOADNAME SWAP DEST|SOUR                                         LOADNAME SWAP DEST|SOUR                                         RESULTFILE DROP 4 + DUP OBJECTPATH DEST|SOUR                    LOADNAME DEST|SOUR ;                                    -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             (                                                    10/17/89 ) : REN_RESULT                                                            RESULTFILE 0 SEARCH-FIRST 0=                                    IF RESULTFILE KILL-FILE ?DISCERR THEN                           OUTFILE RESULTFILE RENAME-FILE ?DISCERR ;               : SET_OBJ ( cstr --- )                                                  INIT_TARGET REN_RESULT EXIT_FORTH ;                                                                       -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ( SOURCE$ MMODULE$ DMODULE$ IMODULE$                 10/15/89 ) DECIMAL                                                         : SOURCE$ BL WORD DROP ;                                        : MMODULE$                                                              LIT" .OBM" SET_OBJ ;                                    : DMODULE$                                                              LIT" .OBD" SET_OBJ ;                                    : IMODULE$                                                              LIT" .OBI" SET_OBJ ;                                    -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( SCAN/E                                             04/23/90 ) : SCAN/E 0 ERRLOC !                                                     SCRATCH_BUFF ASCII / SCAN                                       IF 1+ DUP C@ CAP ASCII E =                                         IF >R 0.0 R> CONVERT 2DROP ERRLOC !                             ELSE DROP                                                       THEN                                                         ELSE DROP                                                       THEN ;                                                  : GETINFILE 0 BLK ! 0 >IN !                                             SCRATCH_BUFF COUNT #TIB ! <TIB> !                               BEGIN >IN @ >R BL WORD                                             COUNT 0= SWAP C@ ASCII / = 0= OR                             UNTIL R> >IN !                                                  INFILE [COMPILE] FILENAME                                       INFILE OPEN-FILE ?DISCERR ; -->                         ( End of MODMAKER: COMP                              10/17/89 ) : COMP  SCAN/E                                                          GETINFILE                                                       ( TLOAD )                                                       CR ." Compiling" CR INIT_OBJ SINIT EXEC                         ( FLOAD ) EXIT_FORTH ;                                  : FATAL 20 XCODE ! EXIT_FORTH ;                                 ' COMP USTART ! ' FATAL UABORT !                                ' EXIT_FORTH UBREAK !                                           TLOAD                                                           ;S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              