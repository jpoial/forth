(                                                    05/28/90 )                                                                                                                                                                                                                   FORTH 83/32                                                                                                            A FAST HIGH-LEVEL FLOATING POINT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (                                                    03/20/90 )   HEX                                                            : ZERO ( 0 E --- 0 0  OR  M E --- M E )                                OVER  0= IF DROP  0 THEN ;                               : FNEGATE  ( M E --- M |-|E )                                          80000000 XOR  ZERO ;                                     : FABS ( M E --- M ||E )                                               7FFFFFFF  AND ;                                          : D2*  ( D1 --- D2 )                                                    2DUP  D+ ;                                              : NORM ( D E1 --- N E2 )                                               >R 2DUP OR                                                      IF BEGIN DUP 0< NOT                                                WHILE D2* R> 1- >R                                              REPEAT SWAP 0< - ?DUP                                 -->                                                            (                                                    03/20/90 )            IF R> ELSE 80000000 R> 1+ THEN                                ELSE R> DROP THEN ;                                     : F2* ( M E1 --- M E2 )                                                 1+  ZERO ;                                              : F*  ( M1 E1 M2 E2 --- M3 E3 )                                         ROT + 40000000 - >R UM* R>  NORM ;                      : FSQ ( M1 E1 --- M2 E2 )                                             2DUP F* ;                                                 : F2/ ( M E1 --- M E2 )                                               1- ZERO ;                                                 : UM/ ( UD UN1 --- UN2 )                                              DUP >R UM/MOD SWAP R>                                           OVER 2* 1+ U< SWAP 0< OR - ;                                                                                              -->                                                            (                                                    03/20/90 )  : D2/ ( D1 --- D2 )                                                   DUP 1 AND 1F <-L ROT 1                                          ->L OR SWAP 2/ ;                                          : F/   ( M1 E1 M2 E2 --- M3 E3 )                                       ROT SWAP - 40000000 + >R                                        0 ROT ROT 2DUP U<                                               IF UM/ R> ZERO                                                  ELSE >R D2/ FABS R> UM/ R> 1+                                   THEN ;                                                   : ALIGN  ( D1 CT --- D2 )                                              40 MIN 0 DO D2/ LOOP ;                                   : RALIGN ( D1 CT --- D2 )                                              1- ?DUP IF ALIGN THEN                                           1 0 D+ D2/ ;                                             -->                                                            (                                                    03/30/90 )  : FSIGN ( D E1 --- |D| E2 )                                            FABS OVER 0< IF >R DNEGATE R>                                   80000000 OR THEN ;                                                                                                       : F+  ( M1 E1 M2 E2 --- M3 E3 )                                        ROT 2DUP >R >R FABS SWAP FABS -                                 DUP IF DUP 0<                                                           IF ROT SWAP NEGATE                                                 R> R> SWAP >R >R                                             THEN 0 SWAP RALIGN                                      THEN SWAP 0 R> R@ XOR 0<                                        IF R@ 0< IF 2SWAP THEN D-                                          R> FSIGN ROT SWAP NORM                                       ELSE D+ IF 1+ 2/ 80000000 OR R> 1+                                 ELSE R> THEN THEN ;           -->                    (                                                    03/30/90 )  : F- ( M1 E1 M2 E2 --- M3 E3 )                                       FNEGATE F+ ;                                               : F< ( M1 E1 M2 E2 --- F )                                           F- 0< SWAP DROP ;                                                                                                          VARIABLE  KN     DECIMAL                                        VARIABLE  PL 3 PL ! HERE   KN !  1. , ,   10. , ,                                        100. , ,       1000. , ,                                      10000. , ,     100000. , ,                                    1000000. , ,   10000000. , ,                                  100000000. , , 1000000000. , ,               : TENS  ( N --- D )                                                     2* 2* 2* KN @ + 2@  SWAP ;  HEX                         : PLACES  ( N ---  )                                                      PL ! ;  -->                                          (                                                    03/30/90 )  : SHIFTS ( E --- CT )                                                  FABS 40000020 - DUP 0< NOT                                      ABORT" TOO BIG" NEGATE ;                                 : SIGN2   0< IF ASCII - HOLD THEN ;                             : F#     ( E M E --- 0 0 )                                             >R PL @ TENS DROP UM* R> SHIFTS                                 RALIGN PL @ ?DUP IF 0 DO # LOOP                                 ASCII . HOLD THEN #S SIGN  ;                             : TUCK ( M E --- E M E )                                               SWAP OVER ;                                              : F.   ( M E ---  )                                                    TUCK <# F# #> TYPE SPACE ;                               : DFLOAT ( D --- M E )                                                 40000040  FSIGN NORM ;                                   -->                                                            (                                                    05/16/90 )  : POINT ( --- N )                                                      DPL @ ;                                                  : F     ( M E --- )                                                    DFLOAT  POINT TENS DFLOAT  F/ ;                          : FCONSTANT ( D ---  )                                                 F 2CONSTANT ;                                            : FLOAT ( N --- M E )                                                  DUP 0< DFLOAT ;                                          : -+    ( E D --- N )                                                  DROP SWAP 0< IF NEGATE THEN ;                            : FIX   ( M E --- N )                                                  TUCK 0 SWAP SHIFTS RALIGN -+ ;                           : INT   ( M E --- N )                                                  TUCK 0 SWAP SHIFTS ALIGN -+ ;                                               -->                                         (                                                    05/16/90 )  1. FCONSTANT ONE DECIMAL                                        34.6680 FCONSTANT X1                                            -57828. FCONSTANT X2                                            2001.18 FCONSTANT X3                                            1.4427  FCONSTANT X4                                                                                                            : EXP ( M1 E1 --- M2 E2 )                                              2DUP INT DUP >R FLOAT F-                                        F2* X2 2OVER FSQ X3 F+ F/                                       2OVER F2/ F- X1 F+ F/                                           ONE F+ FSQ R> + ;                                        : FEXP ( M1 E1 --- M2 E2 )                                             X4 F* EXP ;                                              -->                                                                                                                            (                                                    05/16/90 )  : GET  ( C --- N )                                                     BL WORD DUP 1+ C@ ASCII - = TUCK -                              0 0 ROT CONVERT DROP -+ ;                                : E    ( D  'E  10^ ' --- M E )                                        F GET >R R@ ABS 13301 4004 */MOD                                >R FLOAT 4004 FLOAT F/ EXP R> +                                 R> 0< IF F/ ELSE F* THEN ;                               : E.   ( M E --- )                                                     TUCK FABS 1073741824 TUCK -                                     4004 13301 */MOD >R                                             FLOAT 4004 FLOAT F/ EXP F*                                      2DUP ONE F<                                                     IF 10 FLOAT F* R> 1- >R THEN                                    <# R@ ABS 0 #S R> SIGN2 2DROP                                   ASCII E HOLD F# #> TYPE SPACE ; ;S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      