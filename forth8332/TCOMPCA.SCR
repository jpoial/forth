                                                                Forth  Target COMPilator to Forth-83  /nr.X cross asembler/     V. 1.0.                                                                                                                         Tartu University                                                01.09.1990.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( #1 faili va"ljastus                                11/27/90 ) DECIMAL                                                         : ""  R@ 1+ R@ C@ R> OVER + 1+ >R                                     ODP @ SWAP 2DUP + ODP ! CMOVE ;                                                                                           : <"  ['] "" DP @ ;  IMMEDIATE                                                                                                  : ">  ! ;  IMMEDIATE                                                                                                            : <TYPE>   ODP @ SWAP 2DUP + ODP ! CMOVE ;                                                                                      : <EMIT>   OC, ;                                                                                                                : <SPACES>  0 DO 32 OC, LOOP ;                                  -->                                                                                                                             ( #2                                                 11/27/90 )                                                                 : <CR>  13 OC, 10 OC, ;                                         HEX                                                             : <.>  DUP 8000 AND IF FFFF0000 OR THEN                                 DUP 0 > IF <" ." +" "> THEN  S>D                               SWAP OVER DABS <# #S SIGN #>  <TYPE> ;                                                                                                                                                                                                                                                                                                                                                   -->                                                                                                                                                                                                                                                             ( #3 store data field                                11/22/90 ) DECIMAL                                                         : NTOFILE  <EMIT> ;                                                                                                             : .NUM  DUP 10 < IF  ASCII 0 +                                                    ELSE 10 - ASCII A +                                            THEN                                                            NTOFILE  ;                                                                                                     : DTOFILE  0 DO                                                             DUP C@ 240 AND 16 / .NUM                                        DUP C@ 15 AND .NUM 1+                                          LOOP ;                                               : HTOFILE  2 DTOFILE DROP ;                                                                                                                      -->                                            ( #4                                                 11/22/90 ) ( andme va"lja disasm )                                         : SDATA  BDDP  DDP @ OVER <> IF                                             7 <SPACES> <" ." DATA" "> <CR>                                    BEGIN                                                       DDP @ OVER <                                                    IF DROP 1                                                        ELSE  7 <SPACES> <" ." DC X'" "> 4 DTOFILE 0                     <" ." '" "> <CR> THEN                                        UNTIL   ELSE DROP                                               THEN    7 <SPACES> <" ." END" "> <CR>                                  ;  HEX                                          : KTOFILE    <" ."  *" "> DECIMAL  <.> HEX ;                                                                                                                                                                                            -->                     ( #5                                                 11/22/90 ) DECIMAL                                                         : TOFILE                                                                  DUP C@ SWAP 1+ SWAP <TYPE>                                      ;                                                                                                                     ( otsib tabelist koodi   code 0 - ei olnud ; adr 1 - oli )      : SCRTAB  CROSTAB BEGIN                                                    DUP CRP @ = IF DROP 0 1                                          ELSE 2DUP @ =                                                    IF 4 + SWAP DROP 1 1                                             ELSE  4 + DUP C@ + 1+ 0                                        THEN                                                          THEN                                                           UNTIL ;           -->                                                                                                 ( #6                                                 11/22/90 )                                                                 : SCRRR                                                                   DUP @ NOP = IF   <" ." NOP" ">                                 ELSE    DUP   H@  R2<-()  =                                     IF <" ." R2 <- (X'" "> 2+ H@  CAB ! CAB                          HTOFILE <" ." ')" "> 1                                          ELSE  DUP H@ >< MASK1 AND Rn1<-# >< =                            IF <" ." R" "> DUP C@ 16 / .NUM <" ."  <- X'" ">                 2+ H@  CAB ! CAB HTOFILE <" ." '" "> 1                           ELSE  DUP H@ >< MASK1 AND An1<-# >< =                           IF <" ." A" "> DUP C@ 16 / .NUM <" ."  <- X'" ">                 2+ H@ CAB ! CAB HTOFILE  <" ." '" "> 1                          ELSE  DUP @ >< MASK1 AND Rn1<-(-A6) >< =                        IF <" ." R" "> C@ 16 / .NUM <" ."  <- (-A6)" "> 1              -->                                                ( #7                                                 11/22/90 )                                                                               ELSE  DUP H@ >< MASK1 AND Rn1->(A6+) >< =                       IF <" ." R" "> C@ 16 / .NUM <" ."  -> (A6+)" "> 1         ELSE  DUP   H@ CALLA =                                           IF  <" ." CALL (X'" "> 2+ H@  CAB ! CAB HTOFILE 1                   <" ." ')" ">                                               ELSE  DUP   H@ JMPA =                                            IF  <" ." JMP " ">  2+ H@  CAB ! CAB HTOFILE 1                 ELSE  DUP   H@ JMPR =                                            IF  <" ." SKIP " ">  2+ H@  >H< KTOFILE 1              ELSE DUP @  ><                                                                                        MASK3 AND Rn1<-Rn2 =               IF  <" ." R" "> DUP @ >< 7 AND .NUM <" ."  <- R" ">                 @ >< 64 / 7 AND .NUM 1                             -->                                                             ( #8                                                 11/23/90 )                                                                                                                                               ELSE  DUP @ >< MASK1 AND Rn1<-(-A5) >< =                        IF <" ." R" "> C@ 16 / .NUM <" ."  <- (-A4)" "> 1               ELSE  DUP H@ >< MASK1 AND Rn1->(A5+) >< =                       IF <" ." R" "> C@ 16 / .NUM <" ."  -> (A4+)" "> 1              ELSE  DUP H@ >< MASK1 AND D4<-# >< =                            IF <" ." D4" ">  <" ."  <- X'" ">                                2+ H@ CAB ! CAB HTOFILE  <" ." '" "> 1                      ELSE 0                                                         THEN THEN THEN THEN THEN THEN THEN THEN THEN                    THEN THEN THEN THEN                                            ;                                                                                                                           -->                                                         ( #9                                                 11/23/90 )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -->                                                                                                                                                                                      ( #10                                                11/22/90 )                                                                 : SCODE  7 <SPACES>                                                      SCRRR  IF ELSE @ SCRTAB                                                    IF TOFILE                                                        ELSE   U. CR                                                     ABORT" unknown code "                                         THEN                                                         THEN  <CR> ;                                                                                                                                                                                                                                                                                                                                                                                          -->                                                                                                      ( #11                                                11/22/90 )                                                                 : MNEMO    7 <SPACES> <" ." START" "> <CR>                                 BPDP @   [COMPILE] HEX                                          BEGIN                                                            PDP @ OVER  2DUP - 4 /  1 1 GOTOXY U.  SPACE SPACE                         = IF DROP 1                                     ELSE DUP   SCODE 4 + 0                                               THEN                                                           UNTIL                                                             SDATA                                                         ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    