Modula2DataBase                                                 Key support.                                                                         ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»                MASTER_RECORD+32:ÍÍ>0º >makett    keykompl. 1  º                MASTER_RECORD+36:N  4º komplekt1 passi SA      º                                     ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹                                            .   .   .   .                                            ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹                                     º >makett    keykompl. N  º                     ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶ komplektN passi SA      º                     ³               ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼                   ÚÄÁÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÂÄ ÄÂÄÄÂÄÄÄÄ¿                ³ 0: L(konka)³2: #keys³4: l1³6: SA1³...³ln³SAn ³                ÀÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÁÄ ÄÁÄÄÁÄÄÄÄÙ                                                                                                                                             \ #1 Fill KEY-TAB, KEYSHOW                           10/08/90 ) ( komplektikirjete tyybid )                                     VARIABLE KEY-INDEX   ( komponentide koguarvu loendaja )         VARIABLE #KOMPLEKT                                                                                                              : >TABEL ( i --- A )                                            8 * MASTER_RECORD DUP 32 + H@ + + ;                                                                                             : KEYSHOW ( --- )                                               >vPUHVER >STOREHOUSE KEYDEPOT @ DUP JUURIK ! AIT !              CURSOR-ON PILTETTE DB-EDIT CURSOR-OFF STOREHOUSE>               <vPUHVER ;                                                                                                                      : KEY.PASS ( cfa --- pass )                                     EXECUTE 12 + @ ;                                                -->                                                             \ #2 Put length & shift of a key                     04/25/91 ) VARIABLE NIMEPLATS 40 DECL NIMEPLATS !                          VARIABLE PEARETS  ( originaal-kirjetp )                       VARIABLE CONTX ( hoiul ) VARIABLE CONTrec                       VARIABLE AI    ( MASTER_RECORDi j„rje absaadress )              : GET-K-NAME ( >pass --- >pass >nfa )                           DUP 4 - BODY> >NAME ;                                           : KEILA ( >pass --- >pass )                                     DUP ?TYPE ?TSIZE AI @ H! 2 AI +!  ( pikkus )                    4 + @  AI @ H! 2 AI +!            ( nihe ) ;                    : KEY.ERROR ( >pass --- >pass )                                 H-WINDOW W-CLEAR 1 1 H-WINDOW W-GOTOXY                          ." Invalid keytype:  " GET-K-NAME .NAME KEY DROP ABORT ;        : >KOMPLEKT ( I --- )                                           >TABEL 4 + AI @ MASTER_RECORD - SWAP ! ;                        -->                                                             \ #3 Get originalfields chain                        04/25/91 ) ( otsib v“tmepassi nime abil kirjev„lja passi. )                : VINT ( >nfa.key  --- >pass.originaal )                        NIMEPLATS @ >R DUP C@ 31 AND                                    R@ SWAP 1+ CMOVE R@ C@ 31 AND R@ C!                             R@ DUP C@ + DUP C@ 128 - SWAP C!                                CONTrec @ CONTEXT !                                             R> FIND 0= IF H-WINDOW W-CLEAR 1 1 H-WINDOW W-GOTOXY                          ." Valev“ti!  " NIMEPLATS @ DUP C@ SWAP 1+ SWAP                 TYPE KEY DROP CONTX @ CONTEXT ! ABORT                        ELSE 4 + >BODY CONTX @ CONTEXT !                                THEN ;                                               : LjaSA ( >pass --- >pass )                                     GET-K-NAME VINT KEILA ;                                         -->                                                                                                                             \ #4 Make keysequence                                04/25/91 ) ( tsykkel yle v“tmekirje, otsib nime j„rgi kirjev„ljad ja teeb  v“tmekomplekti passi. AI on j„rje abs-aadress MASTER_RECORDis ) : WEKTOR ( --- )                                                KIRJETYYP @ DUP 8 + @ 1+ AI @ H! 2 AI +!  ( konka pikkus )      DUP 12 + @ AI @ H! 2 AI +!                ( v“tmete arv  )      24 + @                                    ( esimene pass )      BEGIN DUP ?T                                                     CASE 1 OF LjaSA                 ENDOF                                2 OF KEY.ERROR             ENDOF                                3 OF LjaSA                 ENDOF                           ENDCASE                                                           16 + @ DUP 0 = IF DROP EXIT THEN ( next )                    AGAIN ;                                                         -->                                                                                                                             \ #5 Make keysequences structure                     04/25/91 ) : Key-SUPPORT ( --- )                                           >STOREHOUSE 0 JUURIK ! 0 KUVAR ! 0 AIT !                        0 NihE ! 0 TREPP ! KIRJETYYP @ MakeDISPLAY DROP                 JUURIK @ KEYDEPOT ! STOREHOUSE> ;                               : KEY-INST ( A.keytabel --- )                                   #KOMPLEKT @ 0 >                                                 IF #KOMPLEKT @ 8 * + AI !                                          KIRJETYYP @ DUP PEARETS ! 20 + @ CONTrec !                      CONTEXT @ CONTX ! #KOMPLEKT @ 0                                 DO I >KOMPLEKT I 4 * KEY.ARRAY @ + @ KEY.PASS KIRJETYYP !          WEKTOR Key-SUPPORT KEYDEPOT @ I >TABEL !                     LOOP PEARETS @ KIRJETYYP !                                   THEN ;                                                          -->                                                                                                                             \ #6 KEY-SUPPORT: initialisation keyscreen           04/26/91 ) : KEY-SUPPORT ( --- )                                           KIRJETYYP @ PEARETS !                                           MASTER_RECORD 34 + H@ ?DUP                                        IF 0 DO I 4 * KEY.ARRAY @ + @ KEY.PASS KIRJETYYP !                      Key-SUPPORT KEYDEPOT @ I >TABEL !                            LOOP                                                          PEARETS @ KIRJETYYP !                                           1 MASTER_RECORD 6 + H! ACT-INX                               THEN ;                                                        : KEYNUMBER ( --- | v“tmete koguarv > KEY-INDEX )               0 KEY-INDEX ! #KOMPLEKT @ 0                                      DO I 4 * KEY.ARRAY @ + @ KEY.PASS 12 + @ KEY-INDEX +! LOOP ;   ;S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              