 MODULA-2                                                       Main screen file for Free Print. FP-CHAIN:                       0 >next-SA                                                      4 Nr | 0 ( = free text )                                        6 Atom name ( 1=yes )                                           7 Rida                                                          8 Paigutus ( 1=left, 2=right, 3=centre , muidu positsioon )    10 LIIK ( 1=regular, 2=emphasized, 3=double strike, 4=2&3  )    11 KIRI ( 1=pica, 2=condensed, 3=enlarged, 4=enhanced )         12 T@HED ( 1=pica, 2=elite )                                    13 KURSIIV ( 1=regular, 2=italic )                              14 ALLAKR. ( 1=no, 2=yes )                                      15 REAVAHE ( 1=1/8", 2=7/72", 3=1/6" )                          16 EES|TAGA ( 1=ees, 2=taga )                                   17 VAJA|POLE VAJA ( 1=vaja, 0=pole vaja )                       18 FREE TEXT: length; 19..19+length: text.                      \ #1 Printing device                                 05/12/90 ) : PRT-NAME ( handle --- )                                       DROP DBFILE DROP 4 + C@ DUP >R OVER 4 + C!                      DBFILE DROP 5 + OVER 5 + R@ 3 - CMOVE                           5 + R> 3 - + LIT" PRT" COUNT DROP SWAP 3 CMOVE ;                : CMOVE.B ( kust kuhu n --- )                                   0 DO 2DUP OVER C@ 0=                                                 IF SWAP DROP BL SWAP C!                                         ELSE SWAP C@ SWAP C!                                            THEN 1+ SWAP 1+ SWAP                                         LOOP                                                          2DROP ;                                                         -->                                                                                                                                                                                                                                                             \ #2 Printing device                                 05/12/90 ) : PRT>DSK ( --- )                                                 PRN/CON PRT-NAME PRN<>CON                                       STD-OUTPUT ?FILESIZE DROP 1 lpflag ! ;                                                                                        : >TRYKK ( --- )                                                P/D @ CASE 0 OF PRINTER ENDOF                                              1 OF PRT>DSK ENDOF                                              2 OF CONSOLE ENDOF                                         ENDCASE ;                                                                                                                 : INIT-P>D PRN/CON PRT-NAME PRN/CON MAKE-FILE CONSOLE ;                                                                         : CLOSE-P>D PRN/CON PRT-NAME PRN<>CON ;                         VARIABLE FP-CHAIN                                               -->                                                             \ #3 Create master record                            06/17/90 ) : H-CLEAR ( --- )                                               1 1 H-WINDOW W-GOTOXY 58 SPACES                                 1 2 H-WINDOW W-GOTOXY 58 SPACES ;                               : p-CLEAR 0 1 pWG 50 SPACES ;                                   : GET-FCHAIN ( --- f )                                          MASTER_RECORD 55 + C@  0 >                                       IF MASTER_RECORD 36 + H@                                           DUP FP-VIIT ! MASTER_RECORD + FP-CHAIN ! -1                  ELSE 0 THEN ;                                                  : GET-F-CHAIN ( --- f )                                         MASTER_RECORD 56 + C@  0 >                                       IF MASTER_RECORD 38 + H@                                           DUP FP-VIIT ! MASTER_RECORD + FP-CHAIN ! -1                  ELSE 0 THEN ;                                                  -->                                                             \ #4 Variables                                       06/17/90 ) 10 ARRAY FP-P                                                   VARIABLE BiX  1 BiX ! ( tryki-opt-tabeli 1. rida )              10 ARRAY FikK                                                   4 0 FikK ! 5 1 FikK ! 2 2 FikK ! 2 3 FikK ! 2 4 FikK !          5 5 FikK ! 2 6 FikK ! 2 7 FikK ! 6 8 FikK ! 2 9 FikK !          : noOL- 0 BiX @ 2 + pWG 32 EMIT ;                               : noOL+ 0 BiX @ 2 + pWG 16 EMIT ;                               : OPTIONVALUE? ( --- f )                                        BEGIN KELL PCKEY CASE EXITFLAG OF      0  EXIT  ENDOF                                 NEWLINE  OF     -1  EXIT  ENDOF                                 0        OF DROP 0  EXIT  ENDOF                                 ( else )   7 EMIT                                          ENDCASE                                        AGAIN ;                                                         -->                                                             \ #5 Set print options                               06/01/90 ) : F-LIIK! 0 FP-P @ FP-CHAIN @ 10 + C! ;                         : F-KIRI! 1 FP-P @ FP-CHAIN @ 11 + C! ;                         : F-T@HED! 2 FP-P @ FP-CHAIN @ 12 + C! ;                        : F-KURSIIV! 3 FP-P @ FP-CHAIN @ 13 + C! ;                      : F-ALLAKR! 4 FP-P @ FP-CHAIN @ 14 + C! ;                       : F-REVA! 5 FP-P @ FP-CHAIN @ 15 + C! 62 8 pWG 8 SPACES ;       : F-NIMI! 6 FP-P @ FP-CHAIN @ 6 + C! ;                          : F-PAIK! 8 FP-P @ FP-CHAIN @ 8 + H! 70 11 pWG 6 SPACES ;       : S-RIDA!    FP-CHAIN @ 7 + C@ 18 10 pWG . 1 7 FP-P ! ;         : fRIDA1 1 10  pWG ." RIDA NR.         " S-RIDA! ;              : fRIDA2 1 10  pWG ." RIDA NR.         "                        CURSOR-ON #IN FP-CHAIN @ 7 + C! CURSOR-OFF                      1 7 FP-P ! ;                                                    -->                                                                                                                             \ #6  Freeprint    menu                              06/01/90 ) : fLIIK1 1 3 pWG ." LIIK            " Re ." Tavaline  " ReO             27 3 pWG ." Rasvane " 39 3 pWG ." Topelt "                      51 3 pWG ." Topelt ja rasvane" F-LIIK! ;                : fLIIK2 1 3 pWG ." LIIK            Tavaline  "                         27 3 pWG Re ." Rasvane " ReO                                    39 3 pWG ." Topelt "                                            51 3 pWG ." Topelt ja rasvane" F-LIIK! ;                : fLIIK3 1 3 pWG ." LIIK            Tavaline  "                         27 3 pWG ." Rasvane "                                   39 3 pWG Re ." Topelt "  ReO 51 3 pWG ." Topelt ja rasvane"     F-LIIK! ;                                                       : fLIIK4 1 3 pWG ." LIIK            Tavaline  "                         27 3 pWG ." Rasvane "                                   39 3 pWG ." Topelt "  51 3 pWG Re ." Topelt ja rasvane" ReO     F-LIIK! ;                                    -->                \ #7  Freeprint    menu                              06/01/90 ) : fKIRI1 1 4 pWG ." KIRI            " Re ." Standard  " ReO     27 4 pWG ." Tihe " 39 4 pWG ." Lai "                            51 4 pWG ." Poollai " 63 4 pWG ." 1/2k“rgus " F-KIRI! ;         : fKIRI2 1 4 pWG ." KIRI            Standard  "                 27 4 pWG Re ." Tihe " ReO 39 4 pWG ." Lai "                     51 4 pWG ." Poollai " 63 4 pWG ." 1/2k“rgus " F-KIRI! ;         : fKIRI3 1 4 pWG ." KIRI            Standard  "                 27 4 pWG ." Tihe " 39 4 pWG Re ." Lai " ReO                     51 4 pWG ." Poollai " 63 4 pWG ." 1/2k“rgus " F-KIRI! ;         : fKIRI4 1 4 pWG ." KIRI            Standard  "                 27 4 pWG ." Tihe " 39 4 pWG ." Lai "                            51 4 pWG Re ." Poollai " ReO 63 4 pWG ." 1/2k“rgus " F-KIRI! ;  : fKIRI5 1 4 pWG ." KIRI            Standard  "                 27 4 pWG ." Tihe " 39 4 pWG ." Lai " 51 4 pWG ." Poollai "      63 4 pWG Re ." 1/2k“rgus " ReO F-KIRI! ;               -->      \ #8  Freeprint    menu                              06/01/90 ) : fT@HD1 1 5 pWG ." T" "A ." HED           "                                     Re ." Pica " ReO                                       27 5 pWG ." Elite " F-T@HED! ;                          : fT@HD2 1 5 pWG ." T" "A ." HED           Pica "                       27 5 pWG Re ." Elite " ReO F-T@HED! ;                   : fKURS1 1 6 pWG ." KURSIIV         " Re ." Ei " ReO                    27 6 pWG ." Jah " F-KURSIIV! ;                          : fKURS2 1 6 pWG ." KURSIIV         Ei "                                27 6 pWG Re ." Jah "  ReO F-KURSIIV! ;                  : fALAK1 1 7 pWG ." ALLAKRIIPSUTUS  " Re ." Ei " ReO                    27 7 pWG ." Jah " F-ALLAKR! ;                           : fALAK2 1 7 pWG ." ALLAKRIIPSUTUS  Ei "                                27 7 pWG Re ." Jah "  ReO F-ALLAKR! ;                   -->                                                                                                                             \ #9  Freeprint    menu                              06/01/90 ) : fREVA1 1 8  pWG ." REAVAHE         " Re ." 1/8 tolli" ReO     27 8  pWG ." 7/72 tolli" 39 8  pWG ." 1/6 tolli"                51 8  pWG ." n/216 tolli" F-REVA! ;                             : fREVA2 1 8  pWG ." REAVAHE         1/8 tolli"                 27 8 pWG Re ." 7/72 tolli" ReO 39 8 pWG ." 1/6 tolli"           51 8  pWG ." n/216 tolli" F-REVA! ;                             : fREVA3 1 8  pWG ." REAVAHE         1/8 tolli"                 27 8 pWG ." 7/72 tolli" 39 8 pWG Re ." 1/6 tolli" ReO           51 8  pWG ." n/216 tolli" F-REVA! ;                             : fREVA4 1 8  pWG ." REAVAHE         1/8 tolli"                 27 8 pWG ." 7/72 tolli" 39 8 pWG ." 1/6 tolli"                  51 8  pWG Re ." n/216 tolli. n="                                CURSOR-ON #IN ReO FP-CHAIN @ 15 + C! CURSOR-OFF                 5 5 FP-P ! ;                                                    -->                                                             \ #10 Freeprint    menu                              06/01/90 ) : fNIMI1 1 9  pWG ." V" "A ." LJA NIMI       "                  Re ." Jah " ReO 27 9  pWG ." Ei "  F-NIMI! ;                    : fNIMI2 1 9  pWG ." V" "A ." LJA NIMI       Jah "              27 9  pWG Re ." Ei "  ReO F-NIMI! ;                             : fPAIK1 1 11 pWG ." PAIGUTUS        "  Re ." Vasakule " ReO    27 11 pWG ." Paremale " 39 11 pWG ." Keskele "                  51 11 pWG ." Sappa " 63 11 pWG ." Alates: " F-PAIK! ;           : fPAIK2 1 11 pWG ." PAIGUTUS        Vasakule "                 27 11 pWG Re ." Paremale " ReO 39 11 pWG ." Keskele "           51 11 pWG ." Sappa " 63 11 pWG ." Alates: " F-PAIK! ;           : fPAIK3 1 11 pWG ." PAIGUTUS        Vasakule "                 27 11 pWG ." Paremale " 39 11 pWG Re ." Keskele " ReO           51 11 pWG ." Sappa " 63 11 pWG ." Alates: " F-PAIK! ;           -->                                                                                                                             \ #11 Freeprint menu                                 06/18/90 ) : fPAIK4 1 11 pWG ." PAIGUTUS        Vasakule "                 27 11 pWG ." Paremale " 39 11 pWG ." Keskele "                  51 11 pWG Re ." Sappa " ReO 63 11 pWG ." Alates: " F-PAIK! ;    : fPAIK5 1 11 pWG ." PAIGUTUS        Vasakule "                 27 11 pWG ." Paremale " 39 11 pWG ." Keskele "                  51 11 pWG ." Sappa " 63 11 pWG Re ." Alates: "                  CURSOR-ON #IN ReO FP-CHAIN @ 8 + H! CURSOR-OFF                  6 8 FP-P ! ;                                                    : S-TEXT!    FP-CHAIN @ 18 + C@  0 >                              IF 13 12 pWG 60 SPACES FP-CHAIN @ 19 + 60 13 12 pWG TYPE        THEN 1 9 FP-P ! ;                                             : S.ERASE ( --- )                                               >TELEPORT VIDEO-LK @ 3520 + PICT !                              240 0 DO 0 PICT @ I 2 * + C! LOOP ;                             -->                                                             \ #12 Freetext editor                                09/17/91 ) 1 14 !at 0 22 79 24 WINDOW FT.WINDOW                            : GET.FT ( --- )                                                FT.WINDOW W-CLEAR                                               FP-CHAIN @ 19 + 235 0 0 FT.WINDOW W-GOTOXY TYPE                 0 0 FT.WINDOW W-GOTOXY ;                                        : PUT.FT ( --- )                                                >TELEPORT VIDEO-LK @ 3520 + PICT ! FP-CHAIN @ 19 + PATS !       235 0 DO PICT @ I 2 * + C@ DUP 0=                                        IF   I FP-CHAIN @ 18 + C! LEAVE                                 THEN PATS @ I + C!                                           LOOP ;                                                    HEX                                                             : VAHELE? inSert @ 1 = IF 0 inSert ! THEN ;                     DECIMAL                                                         -->                                                             ( Mini Screen Editor                                 11/14/83 ) VARIABLE CUR                                                    : FT.INSERT    CUR @ 2 * 3520 + DUP >R >TELEPORT VIDEO-LK @ +                  DUP 2+ 3994 R> - CMOVE> ;                        : FT.DELETE    CUR @ 2 * 3520 + DUP >R >TELEPORT VIDEO-LK @ +                  DUP 2+ SWAP 3994 R> - CMOVE ;                    : FT.END       CUR @ 2 * 3520 + DUP >R >TELEPORT VIDEO-LK @ +                  3994 R> - 0 DO DUP I 2 * + C@ 0= IF I CUR +!                    LEAVE THEN LOOP DROP ;                           HEX                                                             : .CUR          CUR @ 50 /MOD DUP 2 > IF DROP 2 50 CUR -! THEN                  FT.WINDOW W-GOTOXY ;                            : !CUR          0 2DUP < IF SWAP THEN DROP                                      3FF 2DUP > IF SWAP THEN DROP CUR ! ;            : +CUR          CUR @ + !CUR ;                                  : +.CUR         +CUR .CUR ;                             -->     ( Mini Screen Editor, continued                      11/14/83 ) : HOM           0 CUR ! .CUR ;                                  : CLHC          FT.WINDOW W-CLEAR W-HOME HOM .CUR ;             : FXNKEY CASE                                                     F9          OF   S.ERASE ENDOF                                  F10         OF   GET.FT  ENDOF                                  DOWNARROW   OF   50 +.CUR      ENDOF                            LEFTARROW   OF   -1 +.CUR      ENDOF                            UPARROW     OF   -50 +.CUR     ENDOF                            RIGHTARROW  OF   1 +.CUR       ENDOF                            HOMEKEY     OF   FT.WINDOW W-HOME HOM .CUR ENDOF                ENDKEY      OF   FT.END  .CUR  ENDOF                            Insert      OF   VAHELE        ENDOF                            Delete      OF   FT.DELETE     ENDOF                          7 EMIT ENDCASE ;                                                -->                                                             ( Mini Screen Editor, continued                      11/14/83 ) : MSED  ( --- )                                                 HOM                                                             BEGIN KELL PCKEY                                                  CASE 0           OF   FXNKEY                        ENDOF            EXITFLAG    OF   VAHELE? EXIT                  ENDOF            BACKSPACE   OF   -1 +.CUR 20 EMIT .CUR         ENDOF            NEWLINE     OF   PUT.FT VAHELE? EXIT           ENDOF            HORIZTAB    OF   CUR @ 8 / 8 * 8 + !CUR .CUR   ENDOF       DUP 20 < IF 7 EMIT                                                       ELSE DUP inSert @ 1 = IF   FT.INSERT                                                  THEN EMIT 1 CUR +!                        THEN                                                   ENDCASE                                                       AGAIN ; DECIMAL                                                 -->                                                             \ #16 Freeprint menu                                 06/18/90 ) : FT.SUPPORT ( --- )                                            >vPUHVER CURSOR-ON  GET.FT                                        MSED   CURSOR-OFF                                             <vPUHVER S-TEXT! ;                                              : fFREE1 1 12 pWG ." VABA TEKST: " ;                            : fFREE2 1 12 pWG ." VABA TEKST: " FT.SUPPORT                   1 9 FP-P ! ;                                                    -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ #17 Print option table                             06/01/90 ) : S-ETTE! FP-CHAIN @ 16 + C@ 6 FP-P ! ;                         : F-ETTE! 6 FP-P @ FP-CHAIN @ 16 + C! ;                         VARIABLE C-ETTE1                                                VARIABLE C-ETTE2                                                : fETTE1 1 9  pWG ." TEKST TABELI    "                                            Re ." Ette " ReO                                      27 9  pWG ." Taha "  F-ETTE! ;                          : fETTE2 1 9  pWG ." TEKST TABELI    Ette "                             27 9  pWG Re ." Taha "  ReO F-ETTE! ;                   ' fETTE1 C-ETTE1 !                                              ' fETTE2 C-ETTE2 !                                              -->                                                                                                                                                                                                                                                             \ #18 Freeprint menu                                 06/18/90 ) : fREVA5 1 8  pWG ." REAVAHE         1/8 tolli"                 27 8 pWG ." 7/72 tolli" 39 8 pWG ." 1/6 tolli"                  51 8  pWG Re ." n/216 tolli. n="                                FP-CHAIN @ 15 + C@ . ReO ;                                      : fPAIK6 1 11 pWG ." PAIGUTUS        Vasakule "                         27 11 pWG ." Paremale "                                         39 11 pWG ." Keskele "                                          51 11 pWG ." Sappa "                                            63 11 pWG Re ." Alates: "                                                 FP-CHAIN @ 8 + H@ . ReO ;                     -->                                                                                                                                                                                                                                                                                                                             \ #19 Print option table                             06/01/90 ) 12 6 2ARRAY FPT_TAB                                             ' fLIIK1 1 1 FPT_TAB !            ' fKURS1 4 1 FPT_TAB !        ' fLIIK2 1 2 FPT_TAB !            ' fKURS2 4 2 FPT_TAB !        ' fLIIK3 1 3 FPT_TAB !            ' fALAK1 5 1 FPT_TAB !        ' fLIIK4 1 4 FPT_TAB !            ' fALAK2 5 2 FPT_TAB !        ' fKIRI1 2 1 FPT_TAB !            ' fREVA1 6 1 FPT_TAB !        ' fKIRI2 2 2 FPT_TAB !            ' fREVA2 6 2 FPT_TAB !        ' fKIRI3 2 3 FPT_TAB !            ' fREVA3 6 3 FPT_TAB !        ' fKIRI4 2 4 FPT_TAB !            ' fNIMI1 7 1 FPT_TAB !        ' fT@HD1 3 1 FPT_TAB !            ' fNIMI2 7 2 FPT_TAB !        ' fT@HD2 3 2 FPT_TAB !            ' fRIDA1 8 1 FPT_TAB !        ' fPAIK1 9 1 FPT_TAB !            ' fPAIK2 9 2 FPT_TAB !        ' fPAIK3 9 3 FPT_TAB !            ' fPAIK4 9 4 FPT_TAB !        ' fRIDA2 8 2 FPT_TAB !            ' fPAIK5 9 5 FPT_TAB !        ' fFREE1 10 1 FPT_TAB !          ' fFREE2 10 2 FPT_TAB !  -->   \ #20 Print handle support                           06/01/90 ) ' fKIRI5 2 5 FPT_TAB !            ' fREVA4 6 4 FPT_TAB !        ' fPAIK6 9 6 FPT_TAB !            ' fREVA5 6 5 FPT_TAB !        VARIABLE BIIR                                                   : n-iNDX ( --- )                                                BiX @ 1 - FikK @ BiX @ 1 - FP-P @                               2DUP = IF DROP 1 ELSE 1+ THEN BiX @ 1 - FP-P ! DROP ;           : p-iNDX ( --- )                                                BiX @ 1 - FikK @ BiX @ 1 - FP-P @                               DUP 1 = IF DROP ELSE 1 - SWAP DROP THEN BiX @ 1 - FP-P ! ;      : d-iNDX ( --- )                                                noOL- BiX @ DUP BIIR @ = IF DROP 1 ELSE 1+ THEN BiX ! noOL+ ;   : u-iNDX ( --- )                                                noOL- BiX @ DUP 1 = IF DROP BIIR @ ELSE 1 - THEN BiX ! noOL+ ;  -->                                                                                                                             \ #21 Print handle support                           06/01/90 ) : sHOW_F-OPTION ( --- )                                         BiX @ DUP 1 - FP-P @ FPT_TAB @ EXECUTE ;                        : sHOW_FF-OPTIONS ( --- )                                       noOL- 11 1 DO I DUP 1 - FP-P @ FPT_TAB @ EXECUTE LOOP 1 BiX !   noOL+ ;                                                         : sHOW_F-OPTIONS ( --- )                                        noOL- 10 1 DO I DUP 1 - FP-P @ FPT_TAB @ EXECUTE LOOP 1 BiX !   noOL+ ;                                                         : fEXPR  1 15 pWG Re ." Esc " ReO SPACE ." L" "q ." peta "      Re 17 EMIT 205 EMIT 188 EMIT ReO                                ."  1. Vali, 2. Salvesta v" "@ "@ ." rtus "                     Re 205 EMIT 16 EMIT SPACE 17 EMIT 205 EMIT SPACE 24 EMIT        SPACE 25 EMIT SPACE ReO ."  Vali " ;                            -->                                                                                                                             \ #22 Print handle menu                              06/01/90 ) : liiGU ( key --- )                                             CASE DOWNARROW  OF d-iNDX                   ENDOF                    UPARROW    OF u-iNDX                   ENDOF                    RIGHTARROW OF n-iNDX                   ENDOF                    LEFTARROW  OF p-iNDX                   ENDOF                    F1         OF  MDB-HELP CURSOR-OFF     ENDOF                    F3         OF SWITCH-P/D               ENDOF                    F6         OF CHANGE-COLORS CURSOR-OFF ENDOF                    F7         OF SWITCH-PTY               ENDOF                    F8         OF SWITCH-A/C               ENDOF                    F10        OF SWITCH-F/F               ENDOF                    ALT-P      OF WriteScr                 ENDOF                    ( else )    7 EMIT                                         ENDCASE sHOW_F-OPTION ;                                         -->                                                             \ #23 Print handle support                           06/01/90 ) : sET_F-OPTIONS ( --- f )                                       CURSOR-OFF 9 BIIR !                                             BEGIN KELL PCKEY CASE EXITFLAG OF noOL-    0 EXIT ENDOF                               NEWLINE  OF noOL-   -1 EXIT ENDOF                               0        OF liiGU           ENDOF                               ( else )  7 EMIT                                           ENDCASE                                        AGAIN ;                                                         : TABULA ( pfa --- )                                            40 1 pWG MASTER_RECORD 57 + C@ 1 =                              IF ." SENI ON  " ELSE ." SENI POLE" THEN                        2 2 H-WINDOW W-GOTOXY 58 SPACES Show-Descr                      0 1 pWG Iy ." Kas soovite veergude pealkirja? " Iyo ?YES         IF 1 ELSE 2 THEN MASTER_RECORD 57 + C!                         H-CLEAR p-CLEAR fEXPR ;                       -->               \ #24 Set print options                              06/01/90 ) : INIT_FP-O                                                     1 0 FP-P ! ( regular ) 1 1 FP-P ! ( pica ) 1 2 FP-P ! ( pica )  1 3 FP-P ! ( no italic ) 1 4 FP-P ! ( no underline )            3 5 FP-P ! 62 8 pWG 8 SPACES   ( 1/6" )                         1 6 FP-P !                     ( v„lja nimi | ette )            1 7 FP-P ! 18 10 pWG 4 SPACES  ( rea nr. )                      1 8 FP-P ! 70 11 pWG 6 SPACES  ( vasakule )                     1 9 FP-P ! 13 12 pWG 63 SPACES ( vaba pass ) ;                  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ #25 Free text options                              06/18/90 ) : sET_FF-OPTIONS ( --- f )                                      CURSOR-OFF 10 BIIR !                                            BEGIN KELL PCKEY CASE EXITFLAG OF     0 EXIT ENDOF                                    NEWLINE  OF    -1 EXIT ENDOF                                    0        OF liiGU      ENDOF                                    ( else )  7 EMIT                                           ENDCASE                                        AGAIN ;                                                         : ARVEL? ( --- )                                                30 1 pWG Re FP-CHAIN @ 17 + C@ 1 =                               IF    ." ARVEL      " ELSE  ." MAHA KANTUD" THEN ReO ;         -->                                                                                                                                                                                                                                                             \ #26 Show FP options                                06/20/90 ) : S-LIIK!    FP-CHAIN @ 10 + C@ 0 FP-P ! ;                      : S-KIRI!    FP-CHAIN @ 11 + C@ 1 FP-P ! ;                      : S-T@HED!   FP-CHAIN @ 12 + C@ 2 FP-P ! ;                      : S-KURSIIV! FP-CHAIN @ 13 + C@ 3 FP-P ! ;                      : S-ALLAKR!  FP-CHAIN @ 14 + C@ 4 FP-P ! ;                      : S-REVA!    FP-CHAIN @ 15 + C@ DUP 4 <                         IF 5 FP-P ! 51 8 pWG 3 SPACES ELSE 51 8 pWG . 5 5 FP-P ! THEN ; : S-NIMI!    FP-CHAIN @  6 + C@ 6 FP-P ! ;                      : S-PAIK!    FP-CHAIN @ 8 + H@ DUP DUP 5 < SWAP 0 > AND         IF 8 FP-P ! 59 11 pWG 3 SPACES ELSE 59 11 pWG . 6 8 FP-P !      THEN ;                                                          VARIABLE C-NIMI1 VARIABLE C-NIMI2 ' fNIMI1 C-NIMI1 !  ' fNIMI2  C-NIMI2 !                                                       -->                                                                                                                             \ #27 Show FP options                                06/20/90 ) : ?INIT_FP-O ( --- )                                            FP-CHAIN @ 10 + C@ 0=                                           IF INIT_FP-O 70 11 pWG 4 SPACES 18 10 pWG 4 SPACES              ELSE S-LIIK! S-KIRI! S-T@HED! S-KURSIIV! S-ALLAKR! S-REVA!           S-RIDA! S-PAIK! BIIR @ 10 =                                   IF S-TEXT! S-ETTE! C-ETTE1 @ 7 1 FPT_TAB !                         C-ETTE2 @ 7 2 FPT_TAB !                                      ELSE C-NIMI1 @ 7 1 FPT_TAB ! C-NIMI2 @ 7 2 FPT_TAB ! S-NIMI!    THEN                                                         THEN ;                                                          -->                                                                                                                                                                                                                                                                                                                             \ #28 ?Array                                         06/19/90 ) : ?FREE ( pfa --- f )                                           ( ?Array )                                                      ( IF     TABULA )                                               ( ELSE ) H-CLEAR Show-Descr 14 1 pWG 8 SPACES                            23 0 pWG ." VABA RIDA TABELI "                                  ETTE/TAHA @ 0 = IF ." ETTE" ELSE ." TAHA" THEN                  9 BIIR ! ?INIT_FP-O sHOW_F-OPTIONS                              0 1 pWG ." Kas soovite? " 14 1 pWG ?YES                          IF   1 FP-CHAIN @ 17 + C! ARVEL? sET_F-OPTIONS                       ETTE/TAHA @ 1+ FP-CHAIN @ 16 + C!                          ELSE 0 FP-CHAIN @ 17 + C! ARVEL? sET_F-OPTIONS                  THEN                                                  ( THEN ) H-CLEAR p-CLEAR ;                                      -->                                                                                                                             \ #29 Free text support                              06/19/90 ) : nEXT-ATOM ( --- f )                                           NEXT-ATOM 0= IF 1 I-ATOM +! -1 ELSE 0 THEN ;                    : FP-VIIT! ( --- )                                              FP-VIIT @ 24 + DUP FP-VIIT ! FP-CHAIN @ !                       MASTER_RECORD FP-VIIT @ + FP-CHAIN ! ;                          : fpc! ( n nihe --- )                                           FP-CHAIN @ + C! ;                                               : I-ATOM! ( --- )                                               I-ATOM @ DUP FP-CHAIN @ 4 + H! 1+ FP-CHAIN @ 7 + C!             1 FP-CHAIN @ 17 + C! 1 6 fpc! 1 8 fpc! 1 10 fpc! 1 11 fpc!      1 12 fpc! 1 13 fpc! 1 14 fpc! 3 15 fpc!                         ETTE/TAHA @ 1+ 16 fpc! ?Array                                    IF 1 18 fpc! 1 19 fpc! ARRAY-INIT                                  AIT @ 40 + @ FP-CHAIN @ 20 + ! THEN ;                       -->                                                             \ #30 Free atoms                                     06/19/90 ) : NEXT-CHAIN ( --- f )                                          FP-CHAIN @ @ DUP 0 >                                             IF MASTER_RECORD + FP-CHAIN ! 0 ELSE DROP -1 THEN ;            : E/T! ( --- )                                                  @TT 1 = IF ETTE/TAHA @ 1 XOR ETTE/TAHA ! THEN ;                 -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ #31 Free atoms                                     06/19/90 ) : LOOP-FREE ( --- | vana fail, modify )                         0 ETTE/TAHA ! JUURIK @ AIT ! 1 I-ATOM !                         BEGIN ?Array                                                      IF   E/T! AIT @ @ ?FREE DROP                                    ELSE ( I-ATOM! ) AIT @ @ ?FREE DROP                             THEN nEXT-ATOM IF ( FP-VIIT! ) NEXT-CHAIN  THEN               UNTIL DROP JUURIK @ AIT ! ;                                     : SET-ATOMS ( --- | uus fail, initiation )                      0 ETTE/TAHA ! JUURIK @ AIT ! 1 I-ATOM !                         BEGIN ?Array                                                      IF E/T! THEN I-ATOM! nEXT-ATOM                                  IF FP-VIIT! 0 ELSE -1 THEN                                    UNTIL ( DROP ) JUURIK @ AIT ! ;                                 -->                                                                                                                             \ #32 Free text                                      06/19/90 ) : FF-VIIT!                                                      FP-CHAIN @ 6 + FP-VIIT @ 256 + DUP FP-VIIT !                    I-TEXT @ MASTER_RECORD 56 + C@ < IF FP-CHAIN @ ! ELSE DROP THEN   MASTER_RECORD FP-VIIT @ + FP-CHAIN ! ;                        : F-TEXT? ( --- f )                                             H-CLEAR 2 2 H-WINDOW W-GOTOXY ." VABA TEKST " I-TEXT @ .        14 1 pWG 8 SPACES                                               FP-CHAIN @ 7 + C@ 0 = IF 1 FP-CHAIN @ 7 + C! THEN               10 BIIR ! ?INIT_FP-O sHOW_FF-OPTIONS                            0 1 pWG ." Kas soovite? " 14 1 pWG ?YES                           IF   1 FP-CHAIN @ 17 + C!                                       ELSE 0 FP-CHAIN @ 17 + C!                                       THEN                                                          ARVEL? sET_FF-OPTIONS H-CLEAR p-CLEAR ;                         -->                                                             \ #33 Free text                                      06/19/90 ) : FT.A  C-ETTE1 @ 7 1 FPT_TAB ! C-ETTE2 @ 7 2 FPT_TAB ! ;       : FT.Y  C-NIMI1 @ 7 1 FPT_TAB ! C-NIMI2 @ 7 2 FPT_TAB ! ;       : LOOP-TEXTS ( --- )                                            MASTER_RECORD 56 + C@ 0 >                                       IF FP-VIIT! FP-VIIT @ MASTER_RECORD 38 + H! 1 I-TEXT ! FT.A        MASTER_RECORD 56 + C@ 0                                            DO F-TEXT? DROP FF-VIIT! 1 I-TEXT +! LOOP FT.Y            THEN ;                                                          : FT-SUPPORT ( ---- )                                           LOOP-FREE LOOP-TEXTS ;                                          -->                                                                                                                                                                                                                                                                                                                             \ #34 SET_F-PRINT, SET-FPR, MAKE_FREEPRINT           06/19/90 ) : SET_F-PRINT ( --- )                                           GET-FCHAIN                                                       IF >vPUHVER 0 ETTE/TAHA !                                          p-WINDOW W-BORDER p-WINDOW W-CLEAR                              23 0 pWG ." VABA RIDA TABELI "                                  ETTE/TAHA @ 0 = IF ." ETTE" ELSE ." TAHA" THEN                  fEXPR 1 BiX !                                                   FT-SUPPORT                                                      <vPUHVER                                                     THEN ;                                                                                                                         ( : MAKE_FREEPRINT SET_F-PRINT ; )                              -->                                                                                                                                                                                             \ #35 Loop free text                                 06/21/90 ) : FREE-TEXT ( --- )                                             MASTER_RECORD 56 + C@ DUP 0 >                                     IF MASTER_RECORD 38 + H@ MASTER_RECORD + FP-CHAIN ! 1 I-TEXT !   0 DO 0 FP-CHAIN @ 4 + H! ARVEL? F-TEXT?                                 IF NEXT-CHAIN IF LEAVE THEN 1 I-TEXT +!                         ELSE LEAVE                                                      THEN                                                      LOOP                                                         ELSE DROP                                                       THEN ;                                                        -->                                                                                                                                                                                                                                                                                                                             \ #36 Loop free atom                                 06/21/90 ) VARIABLE i-ATOM                                                 : FREE-ATOM ( --- )                                             1 i-ATOM !                                                      MASTER_RECORD 55 + C@ 1 >                                       IF JUURIK @ AIT ! 0 ETTE/TAHA !                                  BEGIN ?Array                                                     IF  E/T! nEXT-ATOM                                                  IF 1 i-ATOM +! 0 ELSE -1 THEN                               ELSE i-ATOM @ FP-CHAIN @ 4 + H! ARVEL?                               AIT @ @ ?FREE IF nEXT-ATOM ELSE 0 THEN                      IF 1 i-ATOM +! NEXT-CHAIN ELSE -1 THEN                         THEN                                                           UNTIL ( DROP ) JUURIK @ AIT !                                  THEN ;                                                          -->                                                             \ #37 Set free texts                                 06/21/90 ) : FREE-TEXTS ( --- )                                            GET-F-CHAIN                                                      IF >vPUHVER                                                        p-WINDOW W-BORDER p-WINDOW W-CLEAR                              20 0 pWG ." VABA RIDA TABELI ETTE | TAHA"                       FT.A fEXPR 1 BiX !                                              FREE-TEXT FT.Y                                                  <vPUHVER                                                     THEN ;                                                         -->                                                                                                                                                                                                                                                                                                                                                                                             \ #38 Set free atoms                                 06/21/90 ) : FREE-ATOMS ( --- )                                            0 ETTE/TAHA ! GET-FCHAIN                                         IF >vPUHVER                                                        p-WINDOW W-BORDER p-WINDOW W-CLEAR                              23 0 pWG ." VABA RIDA TABELI "                                  ETTE/TAHA @ 0 = IF ." ETTE" ELSE ." TAHA" THEN                  fEXPR 1 BiX !                                                   FREE-ATOM                                                       <vPUHVER                                                     THEN ;                                                         -->                                                                                                                                                                                                                                                                                                                             \ #39  TAB-OPT                                       06/22/90 ) : TAB-OPT1 ( --- )                                              MASTER_RECORD 55 + C@                                            IF JUURIK @ AIT !                                                   BEGIN ?Array                                                      IF   AIT @ @ TABULA                                             THEN nEXT-ATOM                                                       IF NEXT-CHAIN  ELSE -1 THEN                              UNTIL DROP JUURIK @ AIT !                                   THEN ;                                                         -->                                                                                                                                                                                                                                                                                                                                                                                             \ #40  TAB-OPT                                       06/22/90 ) : TAB-OPT ( --- )                                               GET-FCHAIN                                                       IF >vPUHVER                                                        p-WINDOW W-BORDER p-WINDOW W-CLEAR                              fEXPR 1 BiX !                                                   TAB-OPT1                                                        <vPUHVER                                                     THEN ;                                                         -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ #41 Set free texts                                 06/19/90 ) : MOVE-FTEXT ( i --- )                                          FP-CHAIN @ 18 + C@ 0 =                                          IF 4 * TEXT.ARRAY @ + @ DUP TEXT-LENGTH? DUP FP-CHAIN @ 18 + C!    FP-CHAIN @ 19 + SWAP CMOVE                                      FP-CHAIN @ 18 + C@ 0 >                                            IF 1 FP-CHAIN @ 17 + C!                                            #ATOMS @ I-TEXT @ + 2 + FP-CHAIN @ 7 + C!                       1 6 fpc! 1 8 fpc! 1 10 fpc! 1 11 fpc!                           1 12 fpc! 1 13 fpc! 1 14 fpc! 3 15 fpc! 1 16 fpc!            THEN                                                       ELSE DROP                                                       THEN ;                                                          -->                                                                                                                                                                                             ( #42                                                08/17/91 ) : SET-TEXTS ( --- )                                             MASTER_RECORD 56 + C@ 0 >                                       IF MASTER_RECORD 38 + H@                                           DUP FP-VIIT ! MASTER_RECORD + FP-CHAIN !                        0 I-TEXT ! MASTER_RECORD 56 + C@ 0                                    DO I MOVE-FTEXT 1 I-TEXT +! FF-VIIT! DROP LOOP         THEN ;                                                          : MAKE_FREEPRINT ( --- )                                        0 FP-VIIT !                                                     GET-FCHAIN  IF SET-ATOMS THEN                                   GET-F-CHAIN IF SET-TEXTS THEN ;                                 -->                                                                                                                                                                                                                                                             ( #43                                                09/16/91 ) : FT.EDIT ( i --- )                                             DUP 0= IF   FP-VIIT ! GET-F-CHAIN IF FREE-TEXTS THEN                   ELSE DUP I-TEXT ! 1 - 4 * ScP @ 28 + @ + @ FP-CHAIN !                FT.A >vPUHVER p-WINDOW W-BORDER p-WINDOW W-CLEAR                fEXPR 1 BiX ! F-TEXT? DROP FT.Y <vPUHVER                   THEN ;                                                   : EDIT-ftx ( --- )                                              I.ACT@ Y.RIPP !                                                 BEGIN KELL PCKEY CASE                                           0   OF R-FUNC                    ENDOF                          13  OF I.ACT@ FT.EDIT            ENDOF  ( Enter  )              27  OF EXIT                      ENDOF  ( Escape )               ( Else )         7 EMIT                                        ENDCASE AGAIN ;                                                 -->                                                             ( #44                                                09/16/91 ) : FA.EDIT ( i --- )                                             JUURIK @ AIT !                                                  DUP 0= IF   FP-VIIT ! GET-FCHAIN  IF FREE-ATOMS THEN                   ELSE DUP I-ATOM ! 1 - 4 * ScP @ 28 + @ + @ >R                        >vPUHVER p-WINDOW W-BORDER p-WINDOW W-CLEAR                     GET-FCHAIN                                                      BEGIN I-ATOM @ FP-CHAIN @ 4 + H@ =                                IF                  -1                                          ELSE NEXT-ATOM DROP NEXT-CHAIN DROP 0                           THEN                                                          UNTIL                                                           fEXPR 1 BiX ! R> ?FREE DROP <vPUHVER                       THEN ;                                                   -->                                                                                                                             ( #45                                                09/16/91 ) : EDIT-fa ( --- )                                               I.ACT@ Y.RIPP ! 0 ETTE/TAHA !                                   BEGIN KELL PCKEY                                                  CASE 0   OF R-FUNC                    ENDOF                          13  OF I.ACT@ FA.EDIT            ENDOF  ( Enter  )              27  OF EXIT                      ENDOF  ( Escape )              ( Else )         7 EMIT                                    ENDCASE                                                       AGAIN ;                                                         -->                                                                                                                                                                                                                                                                                                                                                                                             ( #46                                                09/26/91 ) : SET-ArrP ( --- )                                              @TT 1 <>                                                        IF MASTER_RECORD 55 + C@                                         IF JUURIK @ AIT ! 0 FP-VIIT ! GET-FCHAIN DROP                       BEGIN ?Array                                                      IF   ARRAY-INIT AIT @ 40 + @ 20 FP-CHAIN @ + !                  THEN nEXT-ATOM                                                       IF NEXT-CHAIN  ELSE -1 THEN                              UNTIL  JUURIK @ AIT !                                       THEN                                                           THEN ;                                                          -->                                                                                                                                                                                                                                                             ( #47                                                09/26/91 ) : TELL-# ( --- #tabeliread )                                    @TT 1 <>                                                         IF FP-CHAIN @ 4 + H@ DUP 0 >                                      IF DROP FP-CHAIN @ 20 + @ DUP 0 >                                 IF ArrP ! @156 FP-CHAIN @ 19 + C@ 0=                               IF @116 - THEN                                               THEN                                                          THEN                                                          ELSE 0                                                          THEN ;                                                         : WIDENESS ( --- laius )                                        FP-CHAIN @ 20 + @ ArrP ! @76 ;                                  -->                                                                                                                                                                                             ( #48                                                09/28/91 )                             VARIABLE A.TABEL  VARIABLE L.TABEL  : TABEL+L ( --- )                                               ArrP @ >R FP-CHAIN @ 20 + @ DUP 0 >                              IF ArrP ! FP-CHAIN @ 19 + C@ 0=                                    IF @12 ELSE @0 A.TABEL ! THEN @76 L.TABEL !                  ELSE DROP                                                       THEN                                                           R> ArrP ! ;                                                     : RIDA+L ( i --- A l )                                          L.TABEL @ * A.TABEL @ + L.TABEL @ ;                             ;S                                                                                                                                                                                                                                                                                                                              