( Bin-files for Forth-83/32                          05/07/90 ) 1 LOAD                                                          ;S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( Binary overlay                                     11/13/83 ) -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( Binary overlay, continued                          11/14/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/14/83 ) DECIMAL                                                          -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/14/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/14/83 )                                                                 -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/14/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (                                                    05/08/90 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (                                                    05/08/90 )                                                                 -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (                                                    05/08/90 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (                                                    05/08/90 ) -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (                                                    05/08/90 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/13/83 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( Binary overlay, continued                          11/14/83 ) -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( #23 forget                                         05/08/90 ) FORTH DEFINITIONS                                               : forget ( nfa --- )                                                DUP HERE U<                                                     IF  CURRENT @ CONTEXT @ <> 24 ?ERROR                                >R VOC-LINK @                                                   BEGIN R@ OVER U<                                                WHILE @ DUP VOC-LINK !                                          REPEAT                                                          BEGIN DUP 6 -                                                         BEGIN N>LINK @ DUP R@ U<                                        UNTIL OVER 4 - ! @ ?DUP 0=                                UNTIL R> DP !                                               ELSE DROP THEN ;                                             -->                                                                                                                            ( # 24  FINDLFA                                      05/07/90 ) -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( #25 save binary file                               05/08/90 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( #26 cont.                                          05/08/90 ) -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( #27 Service: reading binary file                   05/08/90 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( #28 Service: loading binary file                   05/08/90 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( #29 Service: writing binary file                   05/08/90 )                                                                 -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ #30         THANDLE                                10/15/89 ) HANDLE THANDLE THANDLE FILENAME LOADINFO.TMP                    VARIABLE THBUF 252 ALLOT                                        VARIABLE THIN                                                   VARIABLE STAND-LOADED                                           : LOADLOOPINIT ( --- )  0 STAND-LOADED !  RCFAERASE 0 #PROC !       MA-INIT MM-INIT B-INIT DHERE DUP BAAS ! MODBASE !               ERASE-BASETABLE SYS-FFL ST-FFL !                                0 MODFLAG ! 0 EXT-CHAIN !                                       0 PH-FLAG ! 0 DUMMYTYPEAD ! 0 DEFMODULEAD !  ASTART ADP !       WERASE SETTABLE-INIT ;    LOADLOOPINIT                      : LOAD-MODULE ( --- ; counted name in THBUF )                       THBUF OBJNAME THBUF C@ 1+ CMOVE FLOAD ; -->                                                                                                                                                                                                                 \ #31                                                10/19/90 ) : CH-COMP-LOOP ( --- )                                              EXT-CHAIN @ DUP                                                 IF                                                                 BEGIN DUP 4 + @ DUP                                                 IF , ELSE DROP THEN  @ DUP 0=                               UNTIL  DROP                                                  ELSE DROP                                                       THEN ;                                                      -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ #32                                                10/19/90 ) ' ;S               CONSTANT  SEMI.CFA   ( ;S or EXIT mark)      BASE @ HEX                                                      : C.END  ( --- )                                                (  ALSO [COMPILE] FORTH CURRENT @ DEFINITIONS )                    HERE 82 C, ASCII C DUP C, 80 OR C,                              LATEST , CURRENT @ ! SMUDGE                                     COLDEF.CFCONT ,                                                 CCAD FIND SWAP DROP 0= IF ['] RM.INIT , THEN                    CH-COMP-LOOP 0 EXT-CHAIN !                                      HIDDEN SEMI.CFA FORTH , UNSMUDGE                             (  PREVIOUS CURRENT ! ) ;                                       BASE !                                                          : LOADLOOPEND ( --- )                                               [COMPILE] ENVIRONMENT DEFINITIONS C.END ;                    -->                                                            \ #33 RUNMAIN                                        10/15/89 )                                                                 : RUNMAIN ( --- )                                                   CCAD FIND                                                       IF 0 RM.INITFLAG ! EXECUTE                                      ELSE ." Fatal" ABORT                                            THEN ;                                                      : SET-SH-NAME ( --- )                                               OBJNAME >R R@ SCREEN-HANDLE DROP 4 + R> C@ CMOVE                LIT" BIN" 1+ SCREEN-HANDLE DROP 4 + DUP C@ + 2 - 3 CMOVE        OBJECTPATH SCREEN-HANDLE DROP 4 + SOUR|DEST ;               : SET-TA-NAME ( --- )                                               OBJNAME >R R@ SCREEN-HANDLE DROP 4 + R> C@ CMOVE                LIT" TA " 1+ SCREEN-HANDLE DROP 4 + DUP C@ + 2 - 3 CMOVE        OBJECTPATH SCREEN-HANDLE DROP 4 + SOUR|DEST ;                -->                                                            \ #34 MENU                                           10/16/89 ) : RDMNAME? ( --- ; THBUF - counted string, len=0 => eof )           0 THBUF C! THBUF 1+ THIN !                                      BEGIN                                                               THIN @ 1 THANDLE LREAD                                          IF THIN @ THBUF - 1 - THBUF C! 0 THIN @ C! -1                   ELSE THIN @ C@ 10 =                                                 IF   THIN @ THBUF - 1 - THBUF C! 0 THIN @ C! -1                 ELSE THIN @ C@ 13 =                                                 IF   0                                                          ELSE 1 THIN +! 0                                                THEN                                                        THEN                                                        THEN                                                        UNTIL ;                                                      -->                                                            \ #35 MENU                                           10/16/89 ) DECIMAL                                                         : MLOADLOOP ( --- )                                                 THANDLE OPEN-FILE DUP                                           IF CR ." File " THANDLE .FILENAME THEN                          ?DISCERR THBUF 107 THANDLE LREAD DROP                           LOADLOOPINIT CH-FIND [COMPILE] ENVIRONMENT DEFINITIONS          BEGIN [ HEX ]                                                       THBUF 8 THANDLE LREAD DROP THBUF C@ 0D = 0=                 WHILE                                                               THBUF @ 20202020 = 0=                                           IF THANDLE -8 SEEK-REL ?DISCERR RDMNAME?                            THANDLE CLOSE-FILE ?DISCERR                                     CR THBUF COUNT TYPE ABORT                                   THEN [ DECIMAL ]                                         -->                                                            ( #36 MAINTASK                                       10/16/89 )         RDMNAME? LOAD-MODULE                                        REPEAT                                                          THANDLE CLOSE-FILE ?DISCERR                                     LOADLOOPEND ;                                               : MAINTASK ( --- )                                                  INIT_OBJ SCRATCH_BUFF C@ 0=                                     IF ( link )                                                         HERE BIN-BASE-AD ! MLOADLOOP SET-SH-NAME                        ADP @ ASTART - MCODELEN ! LATEST LATEST-AD !                    SCOMP  ( StoPRINT )                                             SET-TA-NAME                                                     [COMPILE] ENVIRONMENT                                           LIT" CC" FIND IF SCW ELSE ABORT" CC??"  THEN             -->                                                                                                                            ( #37 end of screen file                             10/17/89 )     ELSE ( run ) CR                                                     ." Running file: " SCREEN-HANDLE .FILENAME                      MBOOT MBOOTLEN SCREEN-HANDLE CYKLREAD DROP                      [COMPILE] ENVIRONMENT DEFINITIONS                               BIN-BASE-AD @ DP ! LATEST-AD @ CURRENT @ !                      ASTART MCODELEN @ SCREEN-HANDLE CYKLREAD DROP                   HERE SCREEN-HANDLE ?FILESIZE MBOOTLEN MCODELEN @ + -            DUP ALLOT MBOOTLEN MCODELEN @ + SCREEN-HANDLE INITSA            SCREEN-HANDLE CYKLREAD DROP                                     SCREEN-HANDLE CLOSE-FILE ?DISCERR CR RUNMAIN                THEN ;                                                      : STARTLR                                                           ['] EXIT_FORTH UABORT ! MAINTASK EXIT_FORTH ;               : MAKETASK ( --- )                                                  ['] STARTLR UIDENT ! ; -->                                  \ #38 LOADMAIN                                       01/20/90 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( #39   LOAD STANDARD MODULES                        01/31/90 )  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \ #40 semantical i/o                                 12/16/90 )                                                                 : MMODULE$ ( --- ; MMODULE$ XXX ; initializations )                 CR ." Main " BL word 0 DEFMODULEAD ! DROP ;                                                                                 : IMODULE$                                                          BL word FIND                                                    IF EXECUTE DEFMODULEAD !                                        ELSE CR ." No definition module " COUNT TYPE ABORT              THEN CR ." Implementation " ;                                                                                               : DMODULE$                                                          CR ." Definition " BL word 0 DEFMODULEAD ! DROP ;                                                                            -->                                                                                                                            \ #41                                                12/16/90 )                                                                 : CUNIT$ ( --- ; CUNIT$ XXX )                                      BL word DROP CR ;                                                                                                            ;S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              