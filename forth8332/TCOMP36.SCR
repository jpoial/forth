                                                                Forth Target COMPilator to M   /nr.3 enviroment/                V. 2.0.                                                                                                                         Tartu University                                                01.09.1990.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( #3 sa"tib paika pa"ise ja PDP aadressid )                      HEX                                                            : SETFCOMPADR FORGETWORD @ ?DUP                                         IF ELSE COMPWORD @ DUP FORGETWORD ! THEN                        BBPDP @ DUP PDP ! BPDP !                                        BODP ODP !  BEDP EDP !                                          BDDP  DDP !                                                     A4<-# PH, 8100 >H< PH,  ( return stack )                        A6<-# PH, 8000 >H< PH,  ( data stack )                          CALLA PH,  0 PH,  NOP P, STOP P,                                ( siia tuleb pais programmi algusesse )                                                                                                                                                                                                                                                                                                        ;            -->                         ( #4 )                                                          ( vo~tab so~nastikust eelmise so~na )                           : PREVW ( aktiivse so~na NFA, esimese so~na NFA -> eelmine )             2DUP = IF DROP 0                                                 ELSE DUP                                                        BEGIN                                                            2 PICK OVER =                                                   IF ROT 2DROP 1 1                                                 ELSE SWAP DROP DUP N>LINK @ 0                                  THEN                                                           UNTIL THEN ;                                                    DECIMAL                                               : CLRFW OPTABLE TABSIZE @ 1 ?DO                                          DUP @OLD FORGETWORD @ >NAME >= IF DUP -1 !FLAG THEN             13 +                                                            LOOP DROP ; -->                                        ( #5 )        DECIMAL                                                                                                           ( teeb FORGET'i nimeva"lja ja"rgi )                             : FORG  BLK @ 0= IF 1+ DUP 1- C@ 31 AND DUP >R  ( so~na pikkus )        TIB SWAP CMOVE              ( to~stab buhvrisse )               TIB R@ + 0 OVER !           ( lo~ppu 0 )                        1- DUP C@ 127 AND SWAP C!   ( viimane bitt viim. ta"h )         R> #TIB ! 0 >IN ! ELSE DROP THEN [COMPILE] FORGET ;                                                                     -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( #4 transleerib so~na ja paneb ta paika so~nastikku )           HEX                                                            : FCOMP1  81 C, ASCII _ 80 + C, 0 , HERE >R CCOLON , ,                      SETFCOMPADR SETPASS CSEMI , R>  [ DECIMAL ]                   WORD->OBJ BPDP @ - 2/ 2/  >H<                                   BPDP @ 10 + H!                                                (  FORTH DEFINITIONS  )                                         (  FORGETWORD @ FORG  )  CLRFW                                    0 FORGETWORD ! 0 COMPWORD !                                       MOVPASS                     ;                                                                                                                                                                                    -->                                                                                                                                                                                                                                ( #5 tabelite algva"a"rtustamine )  DECIMAL                                                                                      (  # -> adr, lipp - 0 polnud , 1 oli so~nastikus )             : FCIN  DP @ DUP 20 + DP ! DUP 1+ 20 EXPECT SPAN @ OVER C!              SPAN @ OVER + 1+ 32 SWAP C! FIND DP @ 20 - DP ! ;                                                                                           HEX                                         : CKEY BEGIN PCKEY DUP                                                     IF DUP 20 < IF 1 ELSE DROP 0 THEN                                ELSE DROP 1                                                    THEN                                                         UNTIL ;                                                                                                                  -->                                                                                                                                                                                            ( #7 )   DECIMAL                                                VARIABLE OPTMENW 0 OPTMENW H!                                                 1 OPTMENW 2+ H!                                                 1 H,                                                            15 H,                                                           3  H,                                                           0 H,                                                            0  C,                                             VARIABLE FILMENW 0 FILMENW H!                                                 12 FILMENW 2+ H!                                                1  H,                                                           15 H,                                                           3  H,                                                           0 H,                                                            0  C,                                             -->                                                             ( #8 )                                                          VARIABLE COMMENW 0 COMMENW H!                                                 25 COMMENW 2+ H!                                                1 H,                                                            15 H,                                                           5  H,                                                           0 H,                                                            0  C,                                                                                                             VARIABLE COMINFW 0 COMINFW H!                                                 4  COMINFW 2+ H!                                                10 H,                                                           60 H,                                                           2  H,                                                           0 H,                                                            0  C,                   -->                       ( #9 )            DECIMAL                                       VARIABLE DICW 0 DICW H!                                                       36 DICW 2+ H!                                                   2 H,                                                            20 H,                                                           9  H,                                                           0 H,                                                            0  C,                                                                                                             VARIABLE COMPW 0 COMPW H!                                                     17 COMPW 2+ H!                                                  3 H,                                                            30 H,                                                           5  H,                                                           0 H,                                                            0  C,      -->                                    ( #10 tabeli va"ljatru"kk )                                                                                                                   DECIMAL                                           VARIABLE ?WIND 0 ?WIND H!                                                     12 ?WIND 2+ H!                                                  11 H,                                                           32 H,                                                           1  H,                                                           0 H,                                                            5  C, ASCII ?  C, ASCII W C, ASCII O C,                               ASCII R  C, ASCII D C,                                                                                      -->                                                                                                                                                                                                                                                             ( #11 tabeli va"ljatru"kk )                                                                                                                   DECIMAL                                           VARIABLE COMPWIND 0 COMPWIND H!                                               60 COMPWIND 2+ H!                                               1  H,                                                           15 H,                                                           7  H,                                                           0 H,                                                            5  C, ASCII C  C, ASCII W C, ASCII O C,                               ASCII R  C, ASCII D C,                                                                                      -->                                                                                                                                                                                                                                                             ( #12 algva"a"rtustamine )                                                                                                      : CLRHEADTABLE 0 OPTABLE !                                                     1 TABSIZE !  ;                                                                                                   : CLRCOMPTABLE 0 COWOR ! 0 NCOWOR !                                      ;                                                                                                                                                                                                                                                                                                                       -->                                                                                                                                                                                                                                                                                                                            ( #13 tabeli va"ljatru"kk )                                                   DECIMAL         VARIABLE WAD                      VARIABLE COMWIND 0 COMWIND H!                                                 0 COMWIND 2+ H!                                                 15 H,                                                           24 H,                                                           7  H,                                                           0 H,                                                            3  C, ASCII C  C, ASCII O C, ASCII M C,                                                                                                                                           -->                                                                                                                                                                                                                                                                                                                             ( #13 tabeli va"ljatru"kk )                                                                                                                   DECIMAL                                           VARIABLE SUBWIND 0 SUBWIND H!                                                 26 SUBWIND 2+ H!                                                15 H,                                                           24 H,                                                           7  H,                                                           0 H,                                                            3  C, ASCII S  C, ASCII U C, ASCII B C,                                                                                                                                           -->                                                                                                                                                                                                                                                             ( #15 tabeli va"ljatru"kk )                                                                                                                   DECIMAL                                           VARIABLE VARWIND 0 VARWIND H!                                                 52 VARWIND 2+ H!                                                15 H,                                                           24 H,                                                           7  H,                                                           0 H,                                                            3  C, ASCII V  C, ASCII A C, ASCII R C,                                                                                                                                           -->                                                                                                                                                                                                                                                             ( #16 tabeli va"ljatru"kk )                                                                                                                   DECIMAL                                           VARIABLE ERWIND 0 ERWIND H!                                                   20 ERWIND 2+ H!                                                 6 H,                                                            35 H,                                                           1 H,                                                            0 H,                                                            3  C, ASCII E  C, ASCII R C, ASCII R C,                                                                                                                                           -->                                                                                                                                                                                                                                                             ( #17 tabeli va"ljatru"kk )                                                                                                                   DECIMAL                                           VARIABLE HELPWIND 0 HELPWIND H!                                               10 HELPWIND 2+ H!                                               2 H,                                                            55 H,                                                           10 H,                                                           0 H,                                                            4  C, ASCII H  C, ASCII E C, ASCII L C, ASCII P C,                                                                                                                                -->                                                                                                                                                                                                                                                             ( #18                                           )                                                   DECIMAL                     : HELPLINE1 0 24 GOTOXY  COLRE                                          ." F1-help RET-set word  "  26 EMIT ." -next flag "             24 25 EMIT EMIT ." -scroll words TAB-next table "               ." ESC-exit table"    COLYL  ;                                                                                          : HELPLINE3 0 24 GOTOXY SPACE COLRE                                     ." F1-help  TAB-table  Alt-windows  ESC-exit           "   ."                           "    COLYL ;                    : HELPLINE4  0 14 GOTOXY COLRE ." Words-" TABSIZE @ 1- .                     ." Compile word-" NCOWOR @ 4 * COWOR + @ ?DUP                   IF >NAME .NAME ELSE ." nul "    THEN                            ." Balans-" OPTSIZE @ . 8 SPACES CR COLYL ;        -->                                                                                                                             ( #19 )                                                          ( operatsioonid W muutujaga )                                  : WN WAD @ H@ ;                                                 : WX WAD @ 2 + H@ ;                                             : WY WAD @ 4 + H@ ;                                             : WXL WAD @ 6 + H@ ;                                            : WYL WAD @ 8 + H@ ;                                            : WFL WAD @ 10 + H@ ;                                           : WTX WAD @ 12 +    ;                                           : WFL! WAD @ 10 + H! ;                                                                                                                                                                                                                                                        -->                                                                                                                                                                               ( #20 )                                                           ( # -> # )                                                    : CLRWIN  COLYL                                                            WY WYL + 1+ WY 1+                                               DO                                                               WX 1+ I GOTOXY                                                  WXL SPACES                                                     LOOP  ;                                                                                                               ( tru"kib ekraani lo~ppu tu"hikud )                            : CLREND WYL 1+ WY + WFL 1+ WY +                                         ?DO WX 1+ I GOTOXY WXL SPACES LOOP ;                                                                                                                                                     -->                                                                                                                           ( #21  )  DECIMAL                                                ( tru"kitakse W'sse lipu ja"rgi )                               ( flag -> # )                                                  : PRINWIN WFL WYL = IF DROP ELSE 0   SWAP WN 1 >R OPTABLE                 WX WXL + 1- WY GOTOXY  2 PICK .                                 BEGIN  ( mitmes, lipp, mitmendast alata, addr )                  R> DUP TABSIZE @ =                                              IF 2DROP 2DROP 1 ELSE  1+ >R                                     2 PICK OVER @FLAG =                                             IF SWAP DUP                                                      IF 1- SWAP 0                                                                                                                                                                                                                                         -->                                                                                                                           ( #22 jatkuu )                                                             ELSE SWAP DUP DUP >R @OLD OVER @FLAG 12 > IF 4 - THEN           >NAME 4 PICK 1+ WY + WX 1+ SWAP                           DUP >R GOTOXY DUP .NAME C@ 31 AND WXL SWAP - 1- SPACES          WX WXL + 5 - R> GOTOXY R> DUP @FLAG 12 > IF @NEWB . ELSE               DUP @NEWE SWAP @NEWB - . THEN                                   >R >R >R 1+ DUP WYL =                                           IF R> R> R> 2DROP R> 2DROP 1                                     ELSE R> R> R> 0 THEN                                          THEN                                                           ELSE 0                                                         THEN                                                            DUP IF ELSE SWAP 13 + SWAP THEN                                THEN                                                           UNTIL                                                           WAD @ 10 + H! THEN ;           -->                       ( #23 )  HEX                                                     ( joonistab W  # -> # )                                        : SETWIND  COLRA                                                          WY WYL + 1+ WY 1+                                               DO WX I GOTOXY    B3   EMIT                                        WX WXL + 1+ I GOTOXY   B3    EMIT                            LOOP                                                            WX WXL + 1+ WX 1+                                               DO I WY GOTOXY   C4    EMIT                                        I WY WYL + 1+ GOTOXY    C4   EMIT                            LOOP                                                            WX 1+ WY GOTOXY WTX DUP C@ SWAP 1+ SWAP TYPE                    WX WY GOTOXY DA EMIT WX WXL + 1+ WY GOTOXY BF EMIT              WX WY WYL + 1+ GOTOXY C0 EMIT                                   WX WXL + 1+ WY WYL + 1+ GOTOXY D9 EMIT  COLYL                   ;                  -->                                ( #24 )                                                          ( kustutab kogu akna )                                         : CLRWIND WY WYL + 2+  WY                                                 DO                                                               WX I GOTOXY                                                     WXL 2+ SPACES                                                  LOOP ;                                                                                                                                                                                 ( kustutab ER akna   addr -> wad )                             : CLRERWIND KEY DROP COLYL CLRWIND WAD !  ;                                                                                                                                                                                                                                               -->                                                                                                   ( #25 )                                                          ( lu"litab sisse ER akna )                                     : SETERWIND WAD @ ERWIND WAD !                                        SETWIND CLRWIN                                                  WX 1+ WY 1+ GOTOXY COLTA ;                                                                                                : HELPBE  WAD @ HELPWIND WAD !                                            SETWIND CLRWIN ;                                      : HELPEN  KEY DROP                                                        CLRWIND WAD ! ;                                                                                                                                                                                                                                               -->                                                                                                                                                                                     ( #28 HELP )                                                                                                                    : filerr SETERWIND ." File error " CLRERWIND ;                                                                                  HANDLE help                                                     help FILENAME TCOMP.HLP                                                                                                         : DP@ DP @ 50 + ;                                                                                                               -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( #29 HELP ) HEX                                                                                                                : YLDHELP HELPBE  help OPEN-FILE  IF filerr                                ELSE                                                             BEGIN                                                            WX 1+ WY 1+ 2DUP GOTOXY                                         A 0 DO                                                           BEGIN                                                            help 1 DP@ READ 2DROP  DP@ C@                                   DUP KRET = IF help 1 DP@ READ 2DROP DROP 1                       ELSE EMIT 0                                                    THEN                                                           UNTIL                                                           1+ 2DUP GOTOXY                                                 LOOP                                                               -->                                             ( #30 HELP )                                                                                                                              help 1 DP@ READ 2DROP DP@ C@ ASCII . =                          IF 2DROP KEY DROP CLRWIND WAD ! 1                                ELSE                                                             KEY KESC = IF 2DROP   CLRWIND WAD ! 1                            ELSE 0 THEN                                                  THEN                                                          UNTIL                                                          THEN    ;                                                                                                                                                                                                                                                                                                                                                                                -->                                                             ( #31 )                                                                                                                                                                                                                                                                                                                         : SET?WIND WAD @ WABI ! ?WIND WAD !                                        SETWIND CLRWIN ;                                                                                                     : CLR?WIND CLRWIND WABI @ WAD ! ;                                                                                                                                                                                                                                                                -->                                                                                                                                                                                                                            ( #32 kontrollib lippe 1-korras 0-jama )                          DECIMAL                                                       : ?KQLB  CASE                                                           1 OF 1 ENDOF                                                    2 OF 1 ENDOF                                                    5 OF 1 ENDOF                                                   13 OF 1 ENDOF                                                   14 OF 1 ENDOF                                                   0 SWAP ENDCASE  ;                                        HANDLE optable                                                  optable FILENAME FCOMP.TBL                                      : INFNAME SET?WIND WX 1+ WY 1+ GOTOXY QUERY                               optable [COMPILE] FILENAME  CLR?WIND ;                                                                                                                                                                        -->                                     ( #33 tabeli salvestamine )                                          DECIMAL                                                    : SAVETBL  INFNAME                                                        optable MAKE-FILE  IF  filerr                                    ELSE  1 TABSIZE @ OPTABLE                                        BEGIN                                                            >R 2DUP = IF  2DROP  R>                                         ELSE SWAP 1+ SWAP R>                                             DUP @FLAG  ?KQLB   ( kas o~ige lipp )                           IF DUP @OLD OVER @FLAG DUP 13 = SWAP 14 = OR         ( muutuja ?) IF 4 - THEN                                                   >NAME DUP C@ 31 AND  DUP >R DP@ !                               optable 1 DP@ WRITE 2DROP                                      -->                                                                                                                                                                                ( #34 jatkuu )                                                        >R optable R>  1+ R> SWAP WRITE 2DROP                           DUP @FLAG DP@ ! optable 1 DP@ WRITE 2DROP                       13 +   0                                                        ELSE SETERWIND ." bad flag " CLRERWIND DROP 2DROP EXIT          THEN                                                           THEN                                                           UNTIL  0 DP@ ! optable 1 DP@  WRITE                                    optable CLOSE-FILE DROP THEN ;                                                                                                                                                                                                                                                                                                                                                                                                                                              -->                                      ( #33 tabeli lugemine )                                         : LOADTBL  INFNAME                                                        optable OPEN-FILE IF   filerr                                    ELSE  1 TABSIZE !                                                BEGIN                                                            optable 1 DP@ READ 2DROP DP@ C@  ?DUP                      IF >R optable R@ DP@ 1+ READ 2DROP                                 R@ DP@ C! R> DP@ + DUP C@ 127 AND SWAP C!                       DP@ FIND IF SETNEW optable 1 DP@ READ 2DROP                     DP@ @ DUP 13 = SWAP 14 = OR  ( kas on muutuja )                 IF DUP DUP @OLD 4 + !OLD THEN                                   DP@ @ !FLAG 0                                              ELSE SETERWIND ." sellist so~na pole " CLRERWIND 1 THEN             ELSE 1 THEN                                                   UNTIL                                                              optable CLOSE-FILE DROP THEN ;   -->                 ( #36 salvestab programmi prrogrammiva"ljalt         08/30/90 )                                                                 : SAVEPRO  INFNAME                                                        optable MAKE-FILE  IF  filerr                                    ELSE                                                             PDP @ BPDP @ - 4 / >H<  DP@ H!  ( PDP pikkus )                  DDP @ BDDP - 4 / >H<  DP@ 2+ H! ( DDP pikkus )                  optable 4  DP@ WRITE 2DROP                                      optable PDP @ BPDP @ - BPDP @ WRITE 2DROP                       optable DDP @ BDDP - BDDP WRITE 2DROP                                                                                          optable CLOSE-FILE DROP THEN                                                      ;                                                                                                  -->                                                                                                                             ( #34 )                                                          ( tru"kib vahetult ta"idetavad so~nad ekraanile )               ( lipp, mille ja"rgi tru"kkida )                                                                                                                                                               : CONT?WIND  WAD @ >R WABI @ WAD !  PRINWIN CLREND R> WAD ! ;                                                                   : ERWORD SETERWIND ." So~nastikus sellist so~na pole " CLRERWIND          ;                                                                                                                         -->                                                                                                                                                                                                                                                                                                                                                                                         ( #35  COM ekraani interf. )                                     ( sonade sisestus lipuga 1 )                                   : WOTOCO SET?WIND BEGIN                                                   WX 1+ WY 1+ GOTOXY FCIN                                         IF DUP FINDTAB                                                   IF SETERWIND ." S.o. juba tabelis " CLRERWIND DROP 0             ELSE                                                             SETNEW 1 !FLAG COMINF @ CONT?WIND 0                           THEN                                                              ELSE SPAN @ IF ERWORD THEN 1                                 THEN                                                            CLRWIN                                                         UNTIL  CLR?WIND ;                                                                                                                                                                      -->                                                             ( #36  sub ekraani interf. )                                     ( sonade sisestus lipuga 2 )                                   : WOTOSB SET?WIND  BEGIN                                                  WX 1+ WY 1+ GOTOXY FCIN                                         IF DUP FINDTAB                                                   IF SETERWIND ." S.o. juba tabelis " CLRERWIND DROP 0             ELSE                                                             SETNEW SUBINF @ 5 = IF 5 ELSE 2 THEN !FLAG                      SUBINF @ CONT?WIND 0                                          THEN                                                              ELSE SPAN @ IF ERWORD THEN 1                                 THEN                                                            CLRWIN                                                         UNTIL  CLR?WIND ;                                                                                                      -->                                                             ( #37  VAR ekraani interf. )  DECIMAL                                   -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( #38 )                                                                                                                                                                                                                                                                                                                                                                                                     -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( #39 )                                                         : VARINTERF  VARWIND WAD !                                                   BEGIN        0 WFL! VARINF @  PRINWIN CLREND                     CKEY CASE                                                 KESC OF 0 1 ENDOF                                               KAU  OF WN ?DUP IF 1- WAD @ H! THEN 0 ENDOF                     KAD  OF WN 1+ WAD @ H! 0 ENDOF                               KPGNU   OF WN 6 - DUP 0< IF DROP 0 THEN WAD @ H! 0 ENDOF        KPGND   OF WN 6 + WAD @ H! 0 ENDOF                                 KF1  OF YLDHELP 0 ENDOF                                      KFL  OF VARINF @ 13 = IF 14 ELSE 13 THEN VARINF !                       0 WAD @ H!     0 ENDOF                                     KTAB OF 0 1 ENDOF                                                       0 SWAP ENDCASE                                          UNTIL ;  -->                                                                                                            ( #40 )                                                         : SUBINTERF  SUBWIND WAD !                                                   BEGIN        0 WFL! SUBINF @ PRINWIN CLREND                      CKEY CASE                                                 KESC OF 0 1 ENDOF                                               KAU  OF WN ?DUP IF 1- WAD @ H! THEN 0 ENDOF                     KAD  OF WN 1+ WAD @ H! 0 ENDOF                               KPGND   OF WN 6 + WAD @ H! 0 ENDOF                              KPGNU   OF WN 6 - DUP 0< IF DROP 0 THEN WAD @ H! 0 ENDOF           KRET OF WOTOSB 0 ENDOF                                          KF1  OF YLDHELP 0 ENDOF                                         KFL  OF SUBINF @ CASE  2 OF 3 ENDOF                                                    3 OF 2 ENDOF ENDCASE                          SUBINF ! 0 WAD @ H! 0  ENDOF                                                                                            -->                                                        ( #41 )                                                                                                                                 KTAB OF ['] VARINTERF 1 1 ENDOF                                         0 SWAP ENDCASE                                          UNTIL ;                                                 : COMINTERF  COMWIND WAD !                                                   BEGIN        0 WFL! COMINF @ PRINWIN CLREND                      CKEY CASE                                                 KESC OF 0 1 ENDOF                                               KAU  OF WN ?DUP IF 1- WAD @ H! THEN 0 ENDOF                     KAD  OF WN 1+ WAD @ H! 0 ENDOF                                  KRET OF WOTOCO 0 ENDOF                                          KF1  OF YLDHELP 0 ENDOF                                      KPGND   OF WN 6 + WAD @ H! 0 ENDOF                              KPGNU   OF WN 6 - DUP 0< IF DROP 0 THEN WAD @ H! 0 ENDOF          -->                                                      ( #42 )                                                                                                                                                                                                 KFL  OF COMINF @ CASE 0 OF 1 ENDOF 1 OF 4 ENDOF                                       4 OF 0 ENDOF ENDCASE                              COMINF ! 0 WAD @ H! 0 ENDOF                             KTAB OF ['] SUBINTERF 1 1 ENDOF                                         0 SWAP ENDCASE                                          UNTIL ;                                                                                                                  ( balansi paikapanemine )                                      : BALANS SET?WIND WX 1+ WY 1+ GOTOXY ." Sisestage balans: "  #IN         OPTSIZE ! CLR?WIND ;                                                                                                                                                                            -->                                                    ( #45 kustutab tabelist FORGET 'itud so~nad )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               -->                                                                                                                                                                                                                                                                                                                                                                                 ( #44 )                                                         DECIMAL                                                         : PRINAR WY 1+ WY WYL + 1+ SWAP                                          DO                                                                WX 1+ I GOTOXY DUP @                                            IF DUP @ >NAME DUP .NAME C@ 31 AND WXL SWAP - 1-                 SPACES 4 + ELSE WXL SPACES                                     THEN                                                            LOOP DROP ;                                                                                                                                                                                                                                                                -->                                                                                                                                                                                                                                       ( #51 )                                                         ( akna va"ljastus )                                             : OPTFI  CASE                                                           1 OF WX 1+ WY 1+ GOTOXY ." clr Words " ENDOF                    2 OF WX 1+ WY 2+ GOTOXY ." clr Table "                               TABSIZE @ 1- .  ENDOF                                      3 OF WX 1+ WY 3 + GOTOXY ." Balans    "                              OPTSIZE @ .  ENDOF                                           ENDCASE   ;                                           -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( #52 )                                                         ( OPT menu"u" )                                                 : OPTMENU  OPTMENW WAD ! SETWIND CLRWIN                              1 OPTFI 2 OPTFI 3 OPTFI  4 OPTFI 5 OPTFI 6 OPTFI                    1 OPTFIL !                                                     BEGIN OPTFIL @ REVERSE OPTFI REVERSE-OFF                          CKEY CASE                                                     KAD OF OPTFIL @ DUP OPTFI DUP 3 = IF DROP 1                            ELSE 1+ THEN OPTFIL !  0 ENDOF                           KAU OF OPTFIL @ DUP OPTFI 1- DUP                                       IF ELSE 3 THEN OPTFIL !  0 ENDOF                         KESC OF  1 1 ENDOF                                                                   -->                                                                                                                                                                                                                                ( #53 )                                                                       KAL OF KALW 0 1 ENDOF                                           KAR OF KALF 0 1 ENDOF                                     KRET OF OPTFIL @ CASE                                                 1 OF CLRCOMPTABLE 1  ENDOF                                      2 OF 1 ONMU ! CLRHEADTABLE 2  ENDOF                             3 OF BALANS 3 ENDOF                                              ENDCASE                                                          OPTFI 0 ENDOF                                                   0 SWAP                                                     ENDCASE  UNTIL CLRWIND ;                                                                                                                  -->                                                                                                                                                                                                                                        ( #54 )      DECIMAL                                            ( po~hi rida  )                                                 : LINFI  CASE                                                           1 OF 1 0 GOTOXY COLTA ." O"                                          COLRE ." PTIONS " ENDOF                                    2 OF 12 0 GOTOXY COLTA ." F"                                         COLRE ." ILE op. " ENDOF                                   3 OF 25 0 GOTOXY COLTA ." C"                                         COLRE ." OMPILE " ENDOF                                    4 OF 60 0 GOTOXY COLRE ." C. " COLTA                                 ." W" COLRE ." ORDS " ENDOF                                 ENDCASE   COLYL ;                                                                                                      -->                                                                                                                                                                                             ( #55 )                                                         : LREVERSE 7 REAV ! 0 REAP !  ;                                 : LREVERSE-OFF 0 REAV ! 7 REAP ! ;                              : LINFIL ?DUP IF FLNR @ LINFI DUP FLNR         !                         LREVERSE LINFI LREVERSE-OFF                                     ELSE  1 FLNR ! 1 LREVERSE LINFI LREVERSE-OFF THEN ;                                                                                                                                                                                                    -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( #50 mnemo koodi salvestamine                       11/27/90 )                                                                 : SAVEMNE BODP ODP ! MNEMO ." LOPP" ( mn. kood obj. va"ljale )      (      BLK @ 0= IF INFNAME                                                      ELSE  INFNAME  THEN                              )     SCREEN-HANDLE MAKE-FILE IF filerr                               ELSE                                                             SCREEN-HANDLE ODP @ BODP - BODP WRITE 2DROP                     SCREEN-HANDLE  CLOSE-FILE DROP                                 THEN ;                                                                                                                                                                                                                                                                                                                       -->                                                                                                                     ( #57 )                        DECIMAL                                                                                                                                                          : HELPLINE2  0 0 GOTOXY COLRE  80 SPACES 0 0 GOTOXY                          1 LINFI 2 LINFI 3 LINFI 4 LINFI ;                                                                                  : PAISED WX 3 + WY 1+ GOTOXY                                     ." C. words  Subrout.  Var. Const.  Modul   Optimization"                              ;                                                                                                       : NEXW DUP N>LINK @ ?DUP IF SWAP DROP 1 ELSE 0 THEN ;                                                                                                                                                                             -->                                                                                                                                                           ( #58 so~na selekteerimine )                                                                                                    : KEYPGND CWOR @ 5 0 DO LATEST PREVW DROP LOOP CWOR !   ;                                                                       : KEYPGNU CWOR @ 5 0 DO NEXW DROP LOOP CWOR !  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -->                                                             ( #59 )   DECIMAL                                               : PRINW DUP .NAME C@ 31 AND 20 SWAP - 1- SPACES  ;              : PRINBLAN   20 SPACES ;                                        : PRINCWOR WX 1+ WY 5 + GOTOXY REVERSE                                     CWOR  @ PRINW REVERSE-OFF                                       CWOR  @ DUP                                                     4 0 DO WX 1+ WY 4 + I - GOTOXY                                  NEXW                                                            IF  DUP PRINW                                                    ELSE PRINBLAN                                                  THEN SWAP DUP LATEST PREVW                                      WX 1+ WY  6 + I + GOTOXY                                        IF SWAP DROP DUP PRINW                                           ELSE PRINBLAN DROP                                             THEN SWAP                                                      LOOP ;        -->                                     ( #60 liikumine so~nastikus )                                                                                                   : INTCWOR  LATEST CWOR !                                                   DICW WAD ! SETWIND CLRWIN                                       BEGIN                                                            PRINCWOR CKEY CASE                                     KAU OF CWOR @ NEXW DROP CWOR !  0 ENDOF                         KAD OF CWOR @ LATEST PREVW IF CWOR ! ELSE DROP THEN 0 ENDOF     KPGND OF KEYPGND 0 ENDOF                                        KPGNU OF KEYPGNU 0 ENDOF                                        KESC OF 0 1 ENDOF                                               KRET OF CWOR @ 1 ENDOF                                           ENDCASE                                                             UNTIL   CLRWIND ;                                       -->                                                                                                                             ( #61 selekteerimine )     DECIMAL                                                                                              : SELFOR INTCWOR  FORGETWORD ! ;                                : SELWOR INTCWOR  COMPWORD ! ;                                  ( kontrollib, kas tabelis ei ole kompileeritud sonu )           : ?KQLB1  1 TABSIZE @ 1 ?DO                                                 DUP IF                                                               I 1- 13 * OPTABLE + @FLAG ?KQLB                                 IF ELSE DROP 0 THEN                                            THEN                                                         LOOP ;                                                                                                             : COMPING COMPWORD @  IF                                                   ?KQLB1 IF                                                       COMPW WAD ! SETWIND CLRWIN                                      WX 2+ WY 2+ GOTOXY ." Comp.  " COMPWORD @ .NAME -->  ( #62 selekteerimine )     DECIMAL                                                                                                         WX 2+ WY 3 + GOTOXY ." Forget "                                 FORGETWORD @ ?DUP IF .NAME ELSE ." nul " THEN                   WX 2+ WY 4 + GOTOXY ." to exit press ESC "                      KEY KESC <> IF DROP COMPWORD @ NAME>                            COMINFW WAD ! SETWIND CLRWIN  PAISED  1 ONMU !                  FCOMP1 WX 57 + WY 1+ GOTOXY BLINK COLTA ." ok " COLYL           BLINK-OFF KEY DROP CLRWIND COMPW WAD ! CLRWIND                  SAVEMNE  ELSE CLRWIND THEN  ELSE                      SETERWIND ." malus on vana kompileerimis tabel" CLRERWIND                       THEN  ELSE                                      SETERWIND ." pole sona, mida kompileerida" CLRERWIND                                  THEN                                          ;          -->                                                                                                             ( #63 )      DECIMAL                                            ( kompileerimis akna va"ljastus )                               : COMFI  CASE                                                           1 OF WX 1+ WY 1+ GOTOXY ." Compile " ENDOF                      2 OF WX 1+ WY 2+ GOTOXY ." select Word "                              ENDOF                                                     3 OF WX 1+ WY 3 + GOTOXY ." select F.w"                               ENDOF                                                     4 OF WX 1+ WY 4 + GOTOXY ." clr Select "  ENDOF                 5 OF WX 1+ WY 5 + GOTOXY ." Print inf. "                             PRF @ IF ." on " ELSE ." off" THEN  ENDOF                                                                                    ENDCASE                                                     ;                                                         -->                                                                                                                             ( #64 )                                                         : COMAB  COMMENW WAD ! SETWIND CLRWIN                                   1 COMFI 2 COMFI 3 COMFI  4 COMFI 5 COMFI ;                                                                              ( OPT menu"u" )                                                 : COMMENU  COMMENW WAD ! CLRWIN  COMAB                                   1 COMFIL !                                                     BEGIN COMFIL @ REVERSE COMFI REVERSE-OFF                          CKEY CASE                                                     KAD OF COMFIL @ DUP COMFI DUP 5 = IF DROP 1                            ELSE 1+ THEN COMFIL !  0 ENDOF                           KAU OF COMFIL @ DUP COMFI 1- DUP                                       IF ELSE 5 THEN COMFIL !  0 ENDOF                         KESC OF  1 1 ENDOF                                                                   -->                                                                                                ( #65 )                                                                       KAL OF KALF 0 1 ENDOF                                           KAR OF KALW 0 1 ENDOF                                     KRET OF COMFIL @ CASE                                                 1 OF COMPING COMAB     1  ENDOF                                 2 OF SELWOR COMAB  2  ENDOF                                     3 OF SELFOR COMAB 3 ENDOF                                       4 OF 0 FORGETWORD ! 0 COMPWORD ! 4 ENDOF                        5 OF PRF @ IF 0 ELSE -1 THEN PRF ! 5 ENDOF                       ENDCASE                                                          COMFI 0 ENDOF                                                 0 SWAP                                                       ENDCASE  UNTIL CLRWIND ;                                                                                                                                                                                  -->                                        ( #66 )                                                         ( akna va"ljastus )                                             : FILFI  CASE                                                           1 OF WX 1+ WY 1+ GOTOXY ." Save table " ENDOF                   2 OF WX 1+ WY 2+ GOTOXY ." Load table " ENDOF                   3 OF WX 1+ WY 3 + GOTOXY ." Save prog. " ENDOF                    ENDCASE   ;                                           ( OPT menu"u" )                                                 : FILMENU  FILMENW WAD ! SETWIND CLRWIN                                 1 FILFI 2 FILFI 3 FILFI                                          1 OPTFIL !                                                     BEGIN OPTFIL @ REVERSE FILFI REVERSE-OFF                          CKEY CASE                                                     KAD OF OPTFIL @ DUP FILFI DUP 3 = IF DROP 1                                                                                                                          -->                                                                                                                                                               ELSE 1+ THEN OPTFIL !  0 ENDOF                           KAU OF OPTFIL @ DUP FILFI 1- DUP                                       IF ELSE 3 THEN OPTFIL !  0 ENDOF                         KESC OF  1 1 ENDOF                                                    KAL OF KALO 0 1 ENDOF                                           KAR OF KALC 0 1 ENDOF                                     KRET OF OPTFIL @ CASE                                                 1 OF SAVETBL      1  ENDOF                                      2 OF 1 ONMU ! LOADTBL      2 ENDOF                              3 OF SAVEPRO 3 ENDOF                                             ENDCASE                                                          FILFI 0 ENDOF                                       0 SWAP ENDCASE  UNTIL CLRWIND ;                                                  -->                                        ( #68 )                                                         : FIRLIN ?DUP IF ELSE   0 LINFIL 0 THEN BEGIN                            DUP 0= IF 1 1 GOTOXY CKEY THEN                         CASE    KALO OF 1 LINFIL OPTMENU   ENDOF                                KALC OF 3 LINFIL COMMENU   ENDOF                                KALF OF 2 LINFIL FILMENU   ENDOF                                KESC OF FLNR @ LINFI  1 ENDOF                                   KAL  OF FLNR @ 1- LINFIL 0 0 ENDOF                              KAR  OF FLNR @ DUP 3 = IF DROP 1 ELSE 1+ THEN                           LINFIL 0 0 ENDOF                                                                                                                                                                                                                                                                          -->                                                                                                                                                   ( #69 )                                                                 KRET OF FLNR @ CASE                                                     1 OF OPTMENU ENDOF                                              2 OF FILMENU ENDOF                                              3 OF COMMENU ENDOF                                                ENDCASE   0 0        ENDOF                               ENDCASE   UNTIL FLNR @ LINFI                                                     HELPLINE4 ;                                                                                         : TABLEP  COMWIND WAD !                                                   0 WFL!  COMINF @ PRINWIN CLREND                                 SUBWIND WAD !                                                   0 WFL! SUBINF @ PRINWIN  CLREND                                 VARWIND WAD !                                                   0 WFL! VARINF @ PRINWIN CLREND 0 ONMU ! ; -->                                                                         ( #70 )        VARIABLE OLDBAS                                  : WINDOWS COLYL CLEARSCREEN HELPLINE2 COMWIND WAD ! SETWIND               BASE @ OLDBAS ! [COMPILE] HEX                                   0 WFL!  COMINF @ PRINWIN                                        SUBWIND WAD ! SETWIND                                           0 WFL! SUBINF @ PRINWIN                                         VARWIND WAD ! SETWIND                                           0 WFL! VARINF @ PRINWIN                                         HELPLINE4                                                       BEGIN ONMU @ IF TABLEP THEN                                      HELPLINE3 0 1 GOTOXY  ASCII > EMIT                              CKEY CASE                                                        KESC   OF 1 ENDOF                                               KTAB   OF HELPLINE1 COMINTERF 0 ENDOF                           KF1    OF YLDHELP 0 0 ENDOF  -->                                                                                    ( #71 jatkuu )                                                           KF10 OF 0 FIRLIN 0 0 ENDOF                                      KALF OF KALF FIRLIN 0 0 ENDOF                                   KALO OF KALO FIRLIN 0 0 ENDOF                                   KALC OF KALC FIRLIN 0 0 ENDOF                                         0 0 ROT ENDCASE                                           IF 1 ELSE  BEGIN IF EXECUTE 0 ELSE 1 THEN UNTIL 0 THEN             UNTIL COLOL CLEARSCREEN OLDBAS @ BASE ! ;                                                                                                                                                                                                           -->                                                                                                                                                                                                                                                                                                                             ( # 72 so~nastiku lu"liti )                                     ( SHofW word                so~na word pa"is paika )                                                                            ( flag SW&F WORD          paneb so~na lipuga tabelisse )        : W&F  [COMPILE] ' SETNEW SWAP !FLAG ;                                                                                          : ALANS  OPTSIZE ! ;                                            : toPRINT PRF @ IF 0 PRF ! ELSE  -1 PRF ! THEN ;                                                                                                                                                                                                                -->                                                                                                                                                                                                                                                                                                                             ( # 73 )                                                                                                                        ( SCW cword fword     kompileerib so~na cword ja teeb FORGETi ) : CW CLEARSCREEN COMINFW WAD ! SETWIND PAISED                         DUP >NAME COMPWORD !                                            FCOMP1  CLRHEADTABLE COLOL  SAVEMNE CLEARSCREEN ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         